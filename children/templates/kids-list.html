{% extends "base.html" %}
{% load static %}

{% block content %}

    <main class="p-6 lg:p-10 max-w-7xl mx-auto">

        <!-- HEADER + STATS -->
        <div class="flex flex-col gap-6">

            <!-- Tytuł -->
            <div class="flex flex-wrap justify-between items-center gap-4">
                <div class="flex min-w-72 flex-col gap-2">
                    <p class="text-slate-900 dark:text-white text-4xl font-black leading-tight tracking-[-0.033em]">Dzieci</p>
                    <p class="text-slate-500 dark:text-slate-400 text-base font-normal leading-normal">Lista wszystkich dzieci w przedszkolu.</p>
                </div>
                <a href="{% url 'add_kid' %}" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-primary text-black text-sm font-bold leading-normal tracking-[0.015em] hover:bg-primary/90 gap-2">
                    <span class="material-symbols-outlined">add</span>
                    <span class="truncate">Dodaj dziecko</span>
                </a>
            </div>

            <!-- STATYSTYKI -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

                <!-- LICZBA DZIECI -->
                <div class="bg-white dark:bg-slate-900 rounded-xl p-6 shadow border">
                    <p class="text-sm text-slate-600 dark:text-slate-400">Łączna liczba dzieci</p>
                    <p class="text-3xl font-bold mt-1">{{ total_kids }}</p>
                </div>

                <!-- ŚREDNI WIEK -->
                <div class="bg-white dark:bg-slate-900 rounded-xl p-6 shadow border">
                    <p class="text-sm text-slate-600 dark:text-slate-400">Ilość grup</p>
                    <p class="text-3xl font-bold mt-1">{{ groups_count }}</p>
                </div>

                <!-- ŚREDNI CZAS W PLACÓWCE -->
                <div class="bg-white dark:bg-slate-900 rounded-xl p-6 shadow border">
                    <p class="text-sm text-slate-600 dark:text-slate-400">Średni wiek</p>
                    <p class="text-3xl font-bold mt-1">{{ avg_age }} lat</p>
                </div>

            </div>
        </div>

        <!-- FLASH MESSAGES -->
        {% if messages %}
            <div class="mt-6">
                {% for message in messages %}
                    <div class="p-4 rounded-lg bg-green-500 text-white text-center text-lg">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <!-- SEARCH -->
        <div class="mt-8 p-4 rounded-xl border bg-white dark:bg-slate-900">
            <form method="POST">
                {% csrf_token %}
                <div class="relative max-w-sm">
                <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-500">
                    search
                </span>
                    <input type="text" name="search"
                           placeholder="Wpisz imię dziecka..."
                           class="w-full h-10 pl-10 pr-4 rounded-lg border bg-slate-100 dark:bg-slate-800 dark:text-white">
                </div>
            </form>
        </div>

        <!-- LISTA DZIECI -->
        <div class="mt-4 @container">
            <div class="mt-8 space-y-4">

                {% for kid in page_obj %}

                    <div class="bg-white dark:bg-slate-900 border rounded-xl p-4 flex items-center justify-between hover:bg-slate-50 dark:hover:bg-slate-800 transition">

                        <!-- LEWA STRONA -->
                        <div class="flex items-center gap-4">

                            <!-- AVATAR DZIECKA -->
                            <div class="size-12 rounded-full flex items-center justify-center text-white font-bold
                                bg-primary/70 shadow"
                                 style="background-color: {{ kid.avatar_color }}">
                                {{ kid.first_name|first|upper }}
                            </div>

                            <div>
                                <!-- IMIĘ -->
                                <a href="{% url 'kid_details' pk=kid.id %}"
                                   class="text-lg font-semibold text-slate-900 dark:text-white">
                                    {{ kid.first_name }} {{ kid.last_name }}
                                </a>

                                <div class="text-sm text-slate-600 dark:text-slate-400">
                                    Wiek: <span class="font-semibold">{{ kid.years_old }} lat</span> |
                                    W placówce od: <span class="font-semibold">{{ kid.start }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- PRAWA STRONA -->
                        <div class="flex gap-4">
                            <!-- MENU OPCJI -->
                            <details class="relative group">
                                <summary class="cursor-pointer text-slate-700 dark:text-white">
                                    Opcje
                                </summary>

                                <div class="absolute right-0 mt-2 w-44 rounded-xl shadow bg-white dark:bg-slate-800 border p-2">

                                    <a href="{% url 'kid_details' pk=kid.id %}"
                                       class="block px-3 py-2 rounded hover:bg-slate-100 dark:hover:bg-slate-700">
                                        Konto dziecka
                                    </a>

                                    <a href="{% url 'calendar' kid.id month year %}"
                                       class="block px-3 py-2 rounded hover:bg-slate-100 dark:hover:bg-slate-700">
                                        Kalendarz
                                    </a>

                                    {% if perms.director.is_director %}
                                        <a href="{% url 'change_kid_info' pk=kid.id %}"
                                           class="block px-3 py-2 rounded hover:bg-slate-100 dark:hover:bg-slate-700">
                                            Zmień informacje
                                        </a>

                                        <form method="POST" action="{% url 'kid_delete' pk=kid.id %}"
                                              onsubmit="return confirm('Czy na pewno chcesz usunąć dziecko?');">
                                            {% csrf_token %}
                                            <button class="w-full text-left px-3 py-2 text-red-600 hover:bg-red-100">
                                                Usuń dziecko
                                            </button>
                                        </form>
                                    {% endif %}
                                </div>
                            </details>

                        </div>

                    </div>

                {% endfor %}

            </div>

            <!-- PAGINACJA -->
            <div class="flex justify-between items-center mt-8">

                {% if page_obj.has_previous %}
                    <a href="?page={{ page_obj.previous_page_number }}" class="px-3 py-2 border rounded-lg">←</a>
                {% else %}
                    <span class="px-3 py-2 border rounded-lg opacity-30">←</span>
                {% endif %}

                <span class="text-slate-700 dark:text-white">
            Strona {{ page_obj.number }} z {{ page_obj.paginator.num_pages }}
        </span>

                {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}" class="px-3 py-2 border rounded-lg">→</a>
                {% else %}
                    <span class="px-3 py-2 border rounded-lg opacity-30">→</span>
                {% endif %}

            </div>

    </main>

{% endblock %}
