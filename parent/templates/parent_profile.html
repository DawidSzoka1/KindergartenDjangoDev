{% extends "base.html" %}
{% load static %}

{% block content %}
    <body class="font-display bg-background-light dark:bg-background-dark">
    <div class="relative flex min-h-screen w-full flex-col group/design-root overflow-x-hidden">
        <div class="flex flex-grow">

            <main class="flex-1 p-8">
                <div class="max-w-7xl mx-auto">

                    <div class="flex flex-wrap gap-2 mb-6 pt-4">
                        {% if perms.parent.is_parent %}
                            <a class="text-[#618961] dark:text-gray-400 text-sm font-medium leading-normal hover:underline" href="{% url 'home_page' %}">MENU</a>
                        {% else %}
                            <a class="text-[#618961] dark:text-gray-400 text-sm font-medium leading-normal hover:underline" href="{% url 'list_parent' %}">LISTA RODZICÓW</a>
                        {% endif %}
                        <span class="text-[#618961] dark:text-gray-400 text-sm font-medium leading-normal">/</span>
                        <span class="text-[#111811] dark:text-white text-sm font-medium leading-normal">PROFIL RODZICA</span>
                    </div>


                    <div class="flex p-4 @container mb-8 bg-white dark:bg-gray-900 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
                        <div class="flex w-full flex-col md:flex-row gap-6 items-start">

                            <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full flex-shrink-0 w-32 h-32">
                                {% if parent.gender == 2 %}
                                    <img class="rounded-full w-32 h-32 object-cover" src="{% static 'parent_female.jpg' %}" alt="Avatar kobiety"/>
                                {% elif parent.gender == 1 %}
                                    <img class="rounded-full w-32 h-32 object-cover" src="{% static 'parent_male.jpg' %}" alt="Avatar mężczyzny"/>
                                {% else %}
                                    <img class="rounded-full w-32 h-32 object-cover" src="{% static 'gander_null.jpg' %}" alt="Avatar neutralny"/>
                                {% endif %}
                            </div>

                            <div class="flex-grow">
                                <p class="text-[#111811] dark:text-white text-[28px] font-bold leading-tight tracking-[-0.015em]">
                                    {% if parent.first_name and parent.last_name %}
                                        {{ parent.first_name }} {{ parent.last_name }}
                                    {% else %}
                                        {{ parent.user.email }}
                                    {% endif %}
                                </p>

                                <div class="mt-2 flex flex-col sm:flex-row sm:items-center sm:gap-6 gap-1">
                                    <div class="flex items-center gap-2">
                                        <span class="material-symbols-outlined text-[#618961] dark:text-gray-400 text-lg">mail</span>
                                        <p class="text-[#618961] dark:text-gray-400 text-base font-normal leading-normal">{{ parent.user.email }}</p>
                                    </div>
                                    {% if parent.phone %}
                                        <div class="flex items-center gap-2">
                                            <span class="material-symbols-outlined text-[#618961] dark:text-gray-400 text-lg">phone</span>
                                            <p class="text-[#618961] dark:text-gray-400 text-base font-normal leading-normal">{{ parent.phone }}</p>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>

                            <div class="flex w-full md:w-auto gap-3 flex-wrap">
                                {% if perms.parent.is_parent %}
                                    <button class="flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-gray-100 dark:bg-white/10 text-[#111811] dark:text-white text-sm font-bold leading-normal tracking-[0.015em] flex-1 md:flex-auto hover:bg-gray-200 dark:hover:bg-white/20"
                                            onclick="location.href='{% url 'parent_update' parent.id %}'">
                                        <span class="truncate">EDYTUJ PROFIL</span>
                                    </button>
                                    {% if user.email == parent.user.email %}
                                        <button class="flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-primary text-[#111811] dark:text-background-dark text-sm font-bold leading-normal tracking-[0.015em] flex-1 md:flex-auto hover:opacity-90"
                                                onclick="location.href='{% url 'password_change' %}'">
                                            <span class="truncate">ZMIEŃ HASŁO</span>
                                        </button>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

                        <div class="lg:col-span-1 flex flex-col gap-6">
                            <div class="bg-white dark:bg-gray-900 p-6 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
                                <h3 class="text-lg font-bold text-[#111811] dark:text-white mb-4">Dane Kontaktowe i Adresowe</h3>
                                <dl class="space-y-3">

                                    <div class="flex justify-between">
                                        <dt class="text-sm text-[#618961] dark:text-gray-400">Numer Kontaktowy</dt>
                                        <dd class="text-sm font-medium text-[#111811] dark:text-gray-200">
                                            {{ parent.phone|default:"Brak danych" }}
                                        </dd>
                                    </div>

                                    <div class="flex justify-between items-start">
                                        <dt class="text-sm text-[#618961] dark:text-gray-400">Adres Zamieszkania</dt>
                                        <dd class="text-sm font-medium text-[#111811] dark:text-gray-200 text-right max-w-[50%]">
                                            {{ parent.address|default:"Brak danych" }}
                                        </dd>
                                    </div>

                                    <div class="flex justify-between">
                                        <dt class="text-sm text-[#618961] dark:text-gray-400">Miasto</dt>
                                        <dd class="text-sm font-medium text-[#111811] dark:text-gray-200">
                                            {{ parent.city|default:"Brak danych" }}
                                        </dd>
                                    </div>

                                    <div class="flex justify-between">
                                        <dt class="text-sm text-[#618961] dark:text-gray-400">Kod Pocztowy</dt>
                                        <dd class="text-sm font-medium text-[#111811] dark:text-gray-200">
                                            {{ parent.zip_code|default:"Brak danych" }}
                                        </dd>
                                    </div>
                                </dl>
                            </div>
                        </div>

                        <div class="lg:col-span-2 flex flex-col gap-6">
                            <div class="bg-white dark:bg-gray-900 p-6 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
                                <h3 class="text-lg font-bold text-[#111811] dark:text-white mb-4">Przypisane Dzieci</h3>

                                <div class="space-y-4">
                                    {% for kid in parent.kids.all %}
                                        {% if kid.is_active == True %}
                                            <div class="flex items-center justify-between p-3 rounded-lg bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                                                <div class="flex items-center gap-4">
                                                    <span class="material-symbols-outlined text-primary text-xl">child_care</span>

                                                    <a href="{% url 'kid_details' kid.id %}"
                                                       class="font-medium text-[#111811] dark:text-white hover:text-primary transition-colors">
                                                        {{ kid.first_name }} {{ kid.last_name }}
                                                        {% if kid.group %}({{ kid.group.name }}){% endif %}
                                                    </a>
                                                </div>
                                                <div class="flex justify-end gap-2">
                                                    <a href="{% url 'kid_details' kid.id %}" class="flex items-center justify-center size-8 rounded-lg hover:bg-[#f0f4f0] dark:hover:bg-white/10 text-[#618961] dark:text-gray-400" title="Zobacz Profil">
                                                        <span class="material-symbols-outlined text-xl">visibility</span>
                                                    </a>
                                                    {% if perms.director.is_director %}
                                                        <form method="POST" action="{% url 'remove_kid_from_parent' parent_pk=parent.id kid_pk=kid.id %}" onsubmit="return confirm('Czy na pewno chcesz odpiąć dziecko {{ kid.first_name }} od rodzica {{ parent.first_name|default:parent.user.email }}?');">
                                                            {% csrf_token %}
                                                            <button type="submit"
                                                                    class="flex items-center justify-center size-8 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/20 text-red-600 dark:text-red-400"
                                                                    title="Usuń link do dziecka">
                                                                <span class="material-symbols-outlined text-xl">link_off</span>
                                                            </button>
                                                        </form>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        {% endif %}
                                    {% empty %}
                                        <p class="text-sm text-[#618961] dark:text-gray-400 p-2">Ten rodzic nie ma przypisanych aktywnych dzieci.</p>
                                    {% endfor %}

                                    {% if perms.director.is_director %}
                                        <div class="pt-4">
                                            <button onclick="location.href='{% url 'add_parent_to_kid' parent.id %}'"
                                                    class="flex items-center gap-2 min-w-[84px] cursor-pointer justify-center overflow-hidden rounded-lg h-10 px-4 bg-primary text-[#111811] dark:text-background-dark text-sm font-bold leading-normal tracking-[0.015em] hover:opacity-90">
                                                <span class="material-symbols-outlined text-lg">add</span>
                                                <span class="truncate">Linkuj Nowe Dziecko</span>
                                            </button>
                                        </div>
                                    {% endif %}

                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </main>
        </div>
    </div>
    </body>
{% endblock %}