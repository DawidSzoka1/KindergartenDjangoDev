{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"index.html","title":"\ud83c\udfeb System Zarz\u0105dzania Przedszkolem (MarchewkaDjango)","text":"<p>Witaj w oficjalnej dokumentacji projektu KindergartenDjangoDev. Jest to zintegrowana platforma klasy ERP stworzona w Django, s\u0142u\u017c\u0105ca do kompleksowego zarz\u0105dzania plac\u00f3wk\u0105 przedszkoln\u0105.</p>"},{"location":"index.html#gowne-funkcjonalnosci","title":"\ud83c\udf1f G\u0142\u00f3wne Funkcjonalno\u015bci","text":"<p>System zosta\u0142 podzielony na dedykowane modu\u0142y (Aplikacje Django), kt\u00f3re realizuj\u0105 konkretne cele biznesowe:</p>"},{"location":"index.html#profile-i-uprawnienia","title":"\ud83d\udc64 Profile i Uprawnienia","text":"<ul> <li>Accounts: Zaawansowane zarz\u0105dzanie u\u017cytkownikami i system logowania.</li> <li>Director, Teacher, Parent: Trzy niezale\u017cne panele sterowania dostosowane do r\u00f3l w przedszkolu.</li> </ul>"},{"location":"index.html#zarzadzanie-podopiecznymi","title":"\ud83e\uddd2 Zarz\u0105dzanie Podopiecznymi","text":"<ul> <li>Children: Centralny rejestr dzieci, informacje o zdrowiu i opiekunach.</li> <li>Groups: Organizacja dzieci w grupy wiekowe i przypisywanie wychowawc\u00f3w.</li> </ul>"},{"location":"index.html#zycie-przedszkolne","title":"\ud83c\udf4e \u017bycie Przedszkolne","text":"<ul> <li>Meals: Planowanie jad\u0142ospis\u00f3w, monitorowanie wydawanych posi\u0142k\u00f3w i diet.</li> <li>Calendar App: Interaktywny harmonogram zaj\u0119\u0107, \u015bwi\u0105t i wydarze\u0144 przedszkolnych.</li> </ul>"},{"location":"index.html#architektura-systemu","title":"\ud83c\udfd7 Architektura Systemu","text":"<p>Projekt wykorzystuje nowoczesny stos technologiczny, zapewniaj\u0105cy stabilno\u015b\u0107 i skalowalno\u015b\u0107:</p> Komponent Technologia Opis Backend Django 4.x Stabilna logika biznesowa i ORM. Tasks Celery &amp; Redis Obs\u0142uga powiadomie\u0144 i zada\u0144 w tle. UI Framework Bootstrap 5 Responsywny interfejs u\u017cytkownika przez <code>crispy_bootstrap5</code>. Frontend Crispy Forms Eleganckie i walidowane formularze systemowe."},{"location":"index.html#schemat-powiazan-bazodanowych","title":"\ud83d\udcca Schemat Powi\u0105za\u0144 Bazodanowych","text":"<p>Poni\u017cszy diagram przedstawia architektur\u0119 relacji, gdzie Dyrektor stanowi centralny punkt izolacji danych (ka\u017cda plac\u00f3wka posiada w\u0142asny graf powi\u0105za\u0144).</p>"},{"location":"index.html#erdiagram-user-director-posiada-profil-user-teacher-posiada-profil-user-parent-posiada-profil-director-o-group-zarzadza-director-o-kid-nadzoruje-director-o-meal-definiuje-director-o-payment_plan-ustala-group-o-kid-zrzesza-group-o-teacher-ma-przypisanych-parent-o-kid-opiekuje-sie-kid-o-presence-posiada-wpisy-kid-o-meal-korzysta-z-kid-o-payment_plan-jest-rozliczane-teacher-o-post-publikuje-director-o-post-publikuje-post-o-group-jest-adresowany-do","title":"<pre><code>erDiagram\n    USER ||--|| DIRECTOR : \"posiada profil\"\n    USER ||--|| TEACHER : \"posiada profil\"\n    USER ||--|| PARENT : \"posiada profil\"\n\n    DIRECTOR ||--o{ GROUP : \"zarz\u0105dza\"\n    DIRECTOR ||--o{ KID : \"nadzoruje\"\n    DIRECTOR ||--o{ MEAL : \"definiuje\"\n    DIRECTOR ||--o{ PAYMENT_PLAN : \"ustala\"\n\n    GROUP ||--o{ KID : \"zrzesza\"\n    GROUP ||--o{ TEACHER : \"ma przypisanych\"\n\n    PARENT ||--o{ KID : \"opiekuje si\u0119\"\n\n    KID ||--o{ PRESENCE : \"posiada wpisy\"\n    KID }o--|| MEAL : \"korzysta z\"\n    KID }o--|| PAYMENT_PLAN : \"jest rozliczane\"\n\n    TEACHER ||--o{ POST : \"publikuje\"\n    DIRECTOR ||--o{ POST : \"publikuje\"\n    POST }o--|| GROUP : \"jest adresowany do\"</code></pre>","text":""},{"location":"index.html#jak-zaczac","title":"\ud83d\ude80 Jak zacz\u0105\u0107?","text":"<p>Zapoznaj si\u0119 z sekcj\u0105 \ud83d\udee0 Wdro\u017cenie i Start w menu bocznym, aby uruchomi\u0107 projekt lokalnie i zrozumie\u0107 g\u0142\u00f3wny przep\u0142yw danych.</p>"},{"location":"guide/setup.html","title":"Szybki Start (Dev)","text":""},{"location":"guide/setup.html#szybki-start-dla-programisty","title":"\ud83d\udee0 Szybki Start dla Programisty","text":"<p>Ten przewodnik pomo\u017ce Ci b\u0142yskawicznie skonfigurowa\u0107 lokalne \u015brodowisko deweloperskie dla projektu Kindergarten Management System.</p>"},{"location":"guide/setup.html#1-wymagania-systemowe","title":"1. Wymagania systemowe","text":"<p>Zanim zaczniesz, upewnij si\u0119, \u017ce masz zainstalowane nast\u0119puj\u0105ce technologie: * Python 3.10 (zgodnie ze struktur\u0105 <code>.venv</code>). * PostgreSQL (jako g\u0142\u00f3wny silnik bazy danych). * Redis (wymagany jako broker wiadomo\u015bci dla Celery).</p>"},{"location":"guide/setup.html#2-konfiguracja-srodowiska","title":"2. Konfiguracja \u015brodowiska","text":"<p>Wykonaj poni\u017csze polecenia w terminalu, aby przygotowa\u0107 projekt:</p> <pre><code># 1. Sklonuj repozytorium\ngit clone https://github.com/DawidSzoka1/KindergartenDjangoDev\ncd KindergartenDjangoDev\n# 2. Utw\u00f3rz i aktywuj \u015brodowisko wirtualne\npython -m venv .venv\nsource .venv/bin/activate  # Windows: .venv\\Scripts\\activate\n\n# 3. Zainstaluj wymagane biblioteki\npip install -r requirements.txt\n</code></pre>"},{"location":"guide/setup.html#3-konfiguracja-bazy-dancyh-postgresql","title":"3. Konfiguracja bazy dancyh (PostgreSQL)","text":"<p>System do poprawnego dzia\u0142ania wymaga pliku z lokalnymi ustawieniami. Utw\u00f3rz plik MarchewkaDjango/local_settings.py i uzupe\u0142nij go swoimi danymi: <pre><code># MarchewkaDjango/local_settings.py\n\nDATABASES = {\n    'default': {\n        'ENGINE': 'django.db.backends.postgresql',\n        'NAME': 'name',\n        'USER': 'usser',\n        'PASSWORD': 'pass',\n        'HOST': 'localhost',\n        'PORT': 5432,\n    }\n}\nsecret = 'secret' # Twoj unikalny klucz SECRET_KEY\n</code></pre></p>"},{"location":"guide/setup.html#4-inicjalizacja-bazy-danych-i-plikow","title":"4. Inicjalizacja bazy danych i plik\u00f3w","text":"<p>Po skonfigurowaniu po\u0142\u0105czenia z PostgreSQL, przygotuj struktur\u0119 bazy danych oraz zasoby statyczne: <pre><code># Wygeneruj i wykonaj migracje\npython manage.py makemigrations\npython manage.py migrate\n\n# Zbierz pliki statyczne (wymagane dla CSS/JS)\npython manage.py collectstatic\n\n# Opcjonalnie: Utw\u00f3rz administratora panelu Django\npython manage.py createsuperuser\n\n# Uruchomienie serwera \npython manage.py runserver\n</code></pre></p> <p>Adres do pracy: System b\u0119dzie dost\u0119pny pod adresem, kt\u00f3ry wy\u015bwietli serwer WWW (zazwyczaj http://127.0.0.1:8000/).</p>"},{"location":"guide/workflow.html","title":"G\u0142\u00f3wny Przep\u0142yw (Flow)","text":""},{"location":"guide/workflow.html#gowny-scenariusz-operacyjny-end-to-end-flow","title":"\ud83d\udd04 G\u0142\u00f3wny Scenariusz Operacyjny (End-to-End Flow)","text":"<p>Poni\u017cszy opis przedstawia modelow\u0105 \u015bcie\u017ck\u0119 \u017cycia danych w systemie \u2014 od momentu za\u0142o\u017cenia plac\u00f3wki po miesi\u0119czne rozliczenie. Zrozumienie tego przep\u0142ywu jes&gt;</p>"},{"location":"guide/workflow.html#1-inicjacja-systemu-accounts-director","title":"1. Inicjacja Systemu (Accounts &amp; Director)","text":"<ul> <li>Rejestracja Dyrektora: Proces zaczyna si\u0119 od rejestracji nowego Dyrektora. System automatycznie tworzy unikaln\u0105 i odizolowan\u0105 instancj\u0119 plac\u00f3wki przed&gt;</li> <li>Konfiguracja Medi\u00f3w: Dyrektor wgrywa ikony dla grup i posi\u0142k\u00f3w (automatycznie skalowane do 300x300px), co jest wymagane do dalszej pracy w systemie.</li> </ul>"},{"location":"guide/workflow.html#2-przygotowanie-fundamentow-groups-meals-payments","title":"2. Przygotowanie Fundament\u00f3w (Groups, Meals, Payments)","text":"<ul> <li>Tworzenie Struktur: Dyrektor definiuje grupy (np. \"Biedronki\"), plany \u017cywieniowe (np. \"Dieta Standardowa\") oraz sta\u0142e plany p\u0142atnicze (czesne).</li> <li>Blokada Walidacyjna: System uniemo\u017cliwia dodanie dziecka, dop\u00f3ki te trzy elementy nie zostan\u0105 poprawnie skonfigurowane dla danej plac\u00f3wki.</li> </ul>"},{"location":"guide/workflow.html#3-zarzadzanie-kadrami-i-spoecznoscia-teacher-parent","title":"3. Zarz\u0105dzanie Kadrami i Spo\u0142eczno\u015bci\u0105 (Teacher &amp; Parent)","text":"<ul> <li>Zatrudnienie Nauczycieli: Dyrektor zaprasza kadr\u0119 pedagogiczn\u0105. Nauczyciele s\u0105 przypisywani do konkretnych grup, co daje im wgl\u0105d w dane dzieci z tych&gt;</li> <li>Onboarding Rodzic\u00f3w: Dyrektor wysy\u0142a zaproszenia mailowe do rodzic\u00f3w. Po zalogowaniu rodzic widzi wy\u0142\u0105cznie profile dzieci, kt\u00f3re zosta\u0142y mu formalnie&gt;</li> </ul>"},{"location":"guide/workflow.html#4-zycie-codzienne-children-calendar-blog","title":"4. \u017bycie Codzienne (Children, Calendar, Blog)","text":"<ul> <li>Monitorowanie Frekwencji: Nauczyciele ka\u017cdego ranka sprawdzaj\u0105 list\u0119 obecno\u015bci w interaktywnym kalendarzu.</li> <li>Proaktywno\u015b\u0107 Rodzic\u00f3w: Rodzice zg\u0142aszaj\u0105 planowane nieobecno\u015bci (np. wizyta u lekarza) z wyprzedzeniem.</li> <li>Komunikacja: Nauczyciele i dyrekcja publikuj\u0105 og\u0142oszenia, filtruj\u0105c odbiorc\u00f3w wed\u0142ug konkretnych grup przedszkolnych.</li> </ul>"},{"location":"modules/accounts.html","title":"\ud83d\udd10 Accounts (Konta)","text":""},{"location":"modules/accounts.html#modu-kont-i-autoryzacji-accounts","title":"\ud83d\udd10 Modu\u0142 Kont i Autoryzacji (Accounts)","text":"<p>Modu\u0142 odpowiada za fundament bezpiecze\u0144stwa systemu, zarz\u0105dzanie to\u017csamo\u015bci\u0105 u\u017cytkownik\u00f3w oraz definiowanie hierarchii dost\u0119pu w ramach plac\u00f3wek przedszkoln&gt;</p>"},{"location":"modules/accounts.html#logika-biznesowa-i-hierarchia","title":"Logika Biznesowa i Hierarchia","text":"<ul> <li>Model \"Dyrektor-Pierwszy\": Proces rejestracji (<code>Register</code>) jest przeznaczony wy\u0142\u0105cznie dla nowych Dyrektor\u00f3w. Ka\u017cda rejestracja automatycznie tworzy n&gt;</li> <li>System Zaprosze\u0144: Pozostali u\u017cytkownicy (Nauczyciele, Rodzice) nie rejestruj\u0105 si\u0119 samodzielnie. S\u0105 oni dodawani do konkretnej plac\u00f3wki przez Dyrektora&gt;</li> <li>Custom User Model: System rezygnuje z tradycyjnych nazw u\u017cytkownika (username) na rzecz unikalnych adres\u00f3w e-mail jako g\u0142\u00f3wnego identyfikatora logowan&gt;</li> </ul>"},{"location":"modules/accounts.html#workflow-przykad-uzycia","title":"\ud83d\udd04 Workflow / Przyk\u0142ad u\u017cycia:","text":""},{"location":"modules/accounts.html#dla-nowego-dyrektora-wasciciela","title":"\ud83c\udf93 Dla Nowego Dyrektora (W\u0142a\u015bciciela)","text":"<ul> <li>Zadanie: Za\u0142o\u017cenie nowej plac\u00f3wki przedszkolnej w systemie.</li> <li>Dzia\u0142anie: Dyrektor wype\u0142nia formularz rejestracyjny. System tworzy obiekt <code>User</code>, nadaje mu uprawnienia <code>is_director</code> i automatycznie inicjuje powi\u0105z&gt;</li> </ul>"},{"location":"modules/accounts.html#dla-pracownikow-i-rodzicow","title":"\ud83d\udc65 Dla Pracownik\u00f3w i Rodzic\u00f3w","text":"<ul> <li>Zadanie: Uzyskanie dost\u0119pu do panelu swojej plac\u00f3wki.</li> <li>Dzia\u0142anie: U\u017cytkownik otrzymuje wiadomo\u015b\u0107 e-mail z danymi dost\u0119powymi. Przy pierwszym logowaniu system wymusza lub sugeruje zmian\u0119 tymczasowego has\u0142a &gt;</li> </ul>"},{"location":"modules/accounts.html#kluczowe-funkcjonalnosci-techniczne","title":"Kluczowe Funkcjonalno\u015bci Techniczne","text":"<ul> <li>Zarz\u0105dzanie uprawnieniami: Wykorzystuje system grup i pozwole\u0144 Django do rygorystycznego separowania r\u00f3l: Dyrektor (zarz\u0105dzanie), Nauczyciel (edukacja&gt;</li> <li>Bezpiecze\u0144stwo sesji: Zastosowano <code>update_session_auth_hash</code>. Dzi\u0119ki temu po zmianie has\u0142a przez u\u017cytkownika jego aktualna sesja nie zostaje przerwana&gt;</li> </ul>"},{"location":"modules/accounts.html#dokumentacja-techniczna","title":"Dokumentacja Techniczna","text":"<pre><code>erDiagram\n    %% CORE TABLES: Accounts\n    ACCOUNTS_USER {\n        bigint id PK\n        varchar password\n        varchar email UK \"LOGIN\"\n        boolean is_staff\n        boolean is_active\n        boolean is_superuser\n    }\n\n    %% RELATIONS: Permissions &amp; Groups (Standard Django Auth)\n    AUTH_GROUP {\n        integer id PK\n        varchar name UK\n    }\n    AUTH_PERMISSION {\n        integer id PK\n        varchar codename UK\n        integer content_type_id FK\n    }\n\n    %% JUNCTION TABLES (ManyToMany)\n    ACCOUNTS_USER_GROUPS {\n        bigint id PK\n        bigint user_id FK\n        integer group_id FK\n    }\n    ACCOUNTS_USER_USER_PERMISSIONS {\n        bigint id PK\n        bigint user_id FK\n        integer permission_id FK\n    }\n\n    %% KEY LINKS\n    ACCOUNTS_USER ||--o{ ACCOUNTS_USER_GROUPS : \"ManyToMany - Membership\"\n    AUTH_GROUP ||--o{ ACCOUNTS_USER_GROUPS : \"ManyToMany - Group\"\n\n    ACCOUNTS_USER ||--o{ ACCOUNTS_USER_USER_PERMISSIONS : \"ManyToMany - User Permissions\"\n    AUTH_PERMISSION ||--o{ ACCOUNTS_USER_USER_PERMISSIONS : \"ManyToMany - Permission\"</code></pre>"},{"location":"modules/accounts.html#accounts.models.User","title":"<code>accounts.models.User</code>","text":"<p>               Bases: <code>AbstractBaseUser</code>, <code>PermissionsMixin</code></p> Source code in <code>accounts/models.py</code> <pre><code>class User(AbstractBaseUser, PermissionsMixin):\n    email = models.EmailField(db_index=True, unique=True, max_length=254)\n\n    is_staff = models.BooleanField(default=False)\n    is_active = models.BooleanField(default=True)\n    is_superuser = models.BooleanField(default=False)\n\n    objects = CustomUserManager()\n\n    USERNAME_FIELD = 'email'\n    REQUIRED_FIELDS = []\n\n    class Meta:\n        verbose_name = 'User'\n        verbose_name_plural = 'Users'\n</code></pre>"},{"location":"modules/accounts.html#accounts.views.Register","title":"<code>accounts.views.Register</code>","text":"<p>               Bases: <code>View</code></p> Source code in <code>accounts/views.py</code> <pre><code>class Register(View):\n    def get(self, request):\n        if request.user.is_active:\n            messages.info(request, 'Masz juz konto')\n            return redirect('home_page')\n        form = UserRegisterForm()\n        return render(request, \"register.html\", {'form': form})\n\n    def post(self, request):\n        if request.user.is_active:\n            messages.info(request, 'Masz juz konto')\n            return redirect('home_page')\n        form = UserRegisterForm(request.POST)\n        if form.is_valid():\n            email = form.cleaned_data.get('email')\n            if User.objects.filter(email=email).exists():\n                form.add_error('email', 'Ten email jest ju\u017c zaj\u0119ty.')\n            else:\n                form.save()\n                messages.success(request, 'Konto zosta\u0142o utworzone. Mo\u017cesz si\u0119 teraz zalogowa\u0107.')\n                return redirect('login')\n        else:\n            messages.error(request, \"W formularzu wyst\u0105pi\u0142y b\u0142\u0119dy. Sprawd\u017a pola.\")\n        return render(request, \"register.html\", {'form': form})\n</code></pre>"},{"location":"modules/accounts.html#accounts.views.ProfilePasswordUpdate","title":"<code>accounts.views.ProfilePasswordUpdate</code>","text":"<p>               Bases: <code>LoginRequiredMixin</code>, <code>View</code></p> Source code in <code>accounts/views.py</code> <pre><code>class ProfilePasswordUpdate(LoginRequiredMixin, View):\n    def get(self, request):\n\n        password_form = PasswordChangeForm(request.user)\n\n        context = {\n            'password_form': password_form,\n        }\n        return render(request, 'change_password.html', context)\n\n    def post(self, request):\n        password_form = PasswordChangeForm(request.user, request.POST)\n        if password_form.is_valid():\n            user = password_form.save()\n            update_session_auth_hash(request, user)\n\n            return redirect('home_page')\n        messages.error(request, 'wypelnij poprawnie formularz')\n        return redirect('password_change')\n</code></pre>"},{"location":"modules/blog.html","title":"\ud83d\udcdd Blog (Wydarzenia)","text":""},{"location":"modules/blog.html#10-modu-bloga-i-wydarzen-blog","title":"\ud83d\udcdd 10. Modu\u0142 Bloga i Wydarze\u0144 (Blog)","text":"<p>Modu\u0142 <code>blog</code> s\u0142u\u017cy jako wewn\u0119trzna tablica og\u0142osze\u0144, umo\u017cliwiaj\u0105ca kadrze przedszkola komunikacj\u0119 z rodzicami.</p>"},{"location":"modules/blog.html#logika-biznesowa","title":"Logika Biznesowa","text":"<ul> <li>Selektywna Komunikacja: Dzi\u0119ki powi\u0105zaniu post\u00f3w z grupami, dyrekcja i nauczyciele mog\u0105 publikowa\u0107 informacje og\u00f3lne dla ca\u0142ego przedszkola lub wiadom&gt;</li> <li>Interaktywny Dashboard: Strona g\u0142\u00f3wna systemu dostarcza kluczowych informacji dostosowanych do roli u\u017cytkownika (np. statystyki dla dyrektora, skr\u00f3ty &gt;</li> <li>Wyszukiwarka Og\u0142osze\u0144: System umo\u017cliwia szybkie odnalezienie archiwalnych wiadomo\u015bci po s\u0142owach kluczowych, przy jednoczesnym zachowaniu prywatno\u015bci d&gt;</li> </ul>"},{"location":"modules/blog.html#workflow-przykad-uzycia","title":"\ud83d\udd04 Workflow / Przyk\u0142ad u\u017cycia:","text":""},{"location":"modules/blog.html#dla-dyrektora","title":"\ud83c\udf93 Dla Dyrektora","text":"<ul> <li>Zadanie: Opublikowanie og\u0142oszenia o nadchodz\u0105cym pikniku rodzinnym dla ca\u0142ego przedszkola.</li> <li>Dzia\u0142anie: Dyrektor wype\u0142nia formularz w <code>PostListView</code>, zaznaczaj\u0105c wszystkie dost\u0119pne grupy. Post staje si\u0119 widoczny dla wszystkich rodzic\u00f3w i praco&gt;</li> </ul>"},{"location":"modules/blog.html#dla-nauczyciela","title":"\ud83d\udc69\ud83c\udfeb Dla Nauczyciela","text":"<ul> <li>Zadanie: Poinformowanie rodzic\u00f3w z grupy \"Pszcz\u00f3\u0142ki\" o wycieczce do teatru.</li> <li>Dzia\u0142anie: Nauczyciel tworzy post, wybieraj\u0105c z listy tylko swoj\u0105 grup\u0119. Dzi\u0119ki temu og\u0142oszenie nie za\u015bmieca tablicy rodzic\u00f3w z innych oddzia\u0142\u00f3w.</li> </ul>"},{"location":"modules/blog.html#dla-rodzica","title":"\ud83d\udc6a Dla Rodzica","text":"<ul> <li>Zadanie: Sprawdzenie aktualnych informacji dotycz\u0105cych grupy dziecka.</li> <li>Dzia\u0142anie: Rodzic loguje si\u0119 i na stronie g\u0142\u00f3wnej lub li\u015bcie post\u00f3w widzi chronologicznie u\u0142o\u017cone wiadomo\u015bci, kt\u00f3re dotycz\u0105 wy\u0142\u0105cznie grup, do kt\u00f3rych&gt;</li> </ul>"},{"location":"modules/blog.html#dokumentacja-techniczna","title":"Dokumentacja Techniczna","text":"<pre><code>erDiagram\n    %% CORE TABLE: Post Definition\n    ACCOUNTS_USER ||--o{ BLOG_POST : \"ForeignKey, Autor posta\"\n    DIRECTOR_DIRECTOR ||--o{ BLOG_POST : \"ForeignKey, Plac\u00f3wka posta\"\n\n    BLOG_POST ||--o{ GROUPS_GROUPS : \"ManyToMany, Adresat og\u0142oszenia\"\n\n    BLOG_POST {\n        bigint id PK\n        bigint author_id FK\n        bigint director_id FK\n        text content\n        timestamp date_posted\n        boolean is_active\n    }\n\n    %% JUNCTION TABLE for ManyToMany (Implied from blog_post_group)\n    BLOG_POST_GROUP {\n        bigint id PK\n        bigint post_id FK\n        bigint groups_id FK\n    }\n\n    BLOG_POST ||--o{ BLOG_POST_GROUP : \"Relacja do Grup\"\n    GROUPS_GROUPS ||--o{ BLOG_POST_GROUP : \"Relacja do Post\u00f3w\"</code></pre>"},{"location":"modules/blog.html#blog.models.Post","title":"<code>blog.models.Post</code>","text":"<p>               Bases: <code>Model</code></p> Source code in <code>blog/models.py</code> <pre><code>class Post(models.Model):\n    author = models.ForeignKey(User, on_delete=models.CASCADE)\n    date_posted = models.DateTimeField(auto_now_add=True, null=True)\n    content = models.TextField()\n    group = models.ManyToManyField(Groups)\n    director = models.ForeignKey(Director, on_delete=models.CASCADE, null=True)\n    is_active = models.BooleanField(default=True)\n\n    def __str__(self):\n        return self.content\n</code></pre>"},{"location":"modules/blog.html#blog.views.Home","title":"<code>blog.views.Home</code>","text":"<p>               Bases: <code>View</code></p> Source code in <code>blog/views.py</code> <pre><code>class Home(View):\n    def get(self, request):\n        if request.user.get_user_permissions() == {'parent.is_parent'}:\n            kids = get_object_or_404(ParentA, user=request.user.id).kids.filter(is_active=True)\n            return render(request, 'home.html', {'kids': kids})\n        elif request.user.get_user_permissions() == {'teacher.is_teacher'}:\n            teacher = get_object_or_404(Employee, user=request.user.id)\n            return render(request, 'home.html', {'teacher': teacher})\n        elif request.user.get_user_permissions() == {'director.is_director'}:\n            kids = Kid.objects.filter(principal=request.user.id, is_active=True).count()\n            groups = Groups.objects.filter(principal=request.user.id, is_active=True).count()\n            teachers = Employee.objects.filter(principal=request.user.id, is_active=True).count()\n            return render(request, 'home.html', {'teachers_count': teachers, 'groups_count': groups, 'kids_count': kids})\n        return render(request, 'home.html')\n</code></pre>"},{"location":"modules/blog.html#blog.views.PostListView","title":"<code>blog.views.PostListView</code>","text":"<p>               Bases: <code>LoginRequiredMixin</code>, <code>View</code></p> Source code in <code>blog/views.py</code> <pre><code>class PostListView(LoginRequiredMixin, View):\n    def get(self, request):\n        user = request.user.get_user_permissions()\n        form = None\n        if user == {'director.is_director'}:\n            director = Director.objects.get(user=request.user.id)\n            posts = director.post_set.filter(is_active=True).order_by('-date_posted')\n            groups = director.groups_set.filter(is_active=True)\n            form = PostAddForm(director=Director.objects.get(user=request.user.id),\n                               initial={'author': director.user, 'director': director})\n\n        elif user == {'teacher.is_teacher'}:\n            employee = Employee.objects.get(user=request.user.id)\n            posts = employee.principal.first().post_set.filter(is_active=True).order_by('-date_posted')\n            form = PostAddForm(employee=employee,\n                               initial={'author': employee.user, 'director': employee.principal.first()})\n            groups = employee.group\n        elif user == {'parent.is_parent'}:\n            parent = ParentA.objects.get(user=request.user.id)\n            kids = parent.kids.filter(is_active=True)\n            groups = kids.values_list('group__id', flat=True)\n            posts = Post.objects.filter(director=parent.principal.first().id).filter(group__id__in=groups).filter(\n                is_active=True).order_by(\n                '-date_posted')\n        else:\n            raise PermissionDenied\n\n        paginator = Paginator(posts, 3)\n        page_number = request.GET.get(\"page\")\n        page_obj = paginator.get_page(page_number)\n        return render(request, 'post_list.html', {'page_obj': page_obj, 'groups': groups, 'form': form})\n\n    def post(self, request):\n        user = request.user.get_user_permissions()\n        form = None\n        if user == {'director.is_director'}:\n            user = Director.objects.get(user=request.user.id)\n            form = PostAddForm(request.POST, director=Director.objects.get(user=request.user.id),\n                               initial={'author': user.user, 'director': user})\n\n        elif user == {'teacher.is_teacher'}:\n            employee = Employee.objects.get(user=request.user.id)\n            form = PostAddForm(request.POST, employee=employee,\n                               initial={'author': employee.user, 'director': employee.principal.first()})\n        if form.is_valid():\n            form.save()\n            messages.success(request, f'Dodano')\n            return redirect('post_list_view')\n        messages.error(request, f'{form.errors}')\n        return redirect('post_list_view')\n</code></pre>"},{"location":"modules/blog.html#blog.views.PostSearchView","title":"<code>blog.views.PostSearchView</code>","text":"<p>               Bases: <code>LoginRequiredMixin</code>, <code>View</code></p> Source code in <code>blog/views.py</code> <pre><code>class PostSearchView(LoginRequiredMixin, View):\n    def get(self, request):\n        return redirect('post_list_view')\n\n    def post(self, request):\n        search = request.POST.get('search')\n        user = request.user\n        user_perm = user.get_user_permissions()\n        form = None\n        if user_perm == {'director.is_director'}:\n            director = Director.objects.get(user=request.user.id)\n            posts = Post.objects.filter(director=user.director).filter(is_active=True).filter(\n                content__icontains=search).order_by(\n                '-date_posted')\n            form = PostAddForm(director=Director.objects.get(user=request.user.id),\n                               initial={'author': director.user, 'director': director})\n            groups = director.groups_set.filter(is_active=True)\n        elif user_perm == {'teacher.is_teacher'}:\n            employee = Employee.objects.get(user=request.user.id)\n            form = PostAddForm(employee=employee, initial={'author': employee, 'director': employee.principal.first()})\n            groups = employee.group\n            posts = Post.objects.filter(director=user.employee.principal.first().id).filter(is_active=True).filter(\n                content__icontains=search).order_by(\n                '-date_posted')\n        elif user_perm == {'parent.is_parent'}:\n            parent = ParentA.objects.get(user=request.user.id)\n            kids = parent.kids.filter(is_active=True)\n            groups = kids.values_list('group__id', flat=True)\n            posts = Post.objects.filter(director=user.parenta.principal.first().id).filter(is_active=True).filter(\n                group__id__in=groups).filter(\n                content__icontains=search).order_by(\n                '-date_posted')\n\n            kids = parent.kids.filter(is_active=True)\n            groups = kids.values_list('group', flat=True)\n\n        else:\n            raise PermissionDenied\n        paginator = Paginator(posts, 3)\n        page_number = request.GET.get(\"page\")\n        page_obj = paginator.get_page(page_number)\n        return render(request, 'post_list.html', {'page_obj': page_obj, 'groups': groups, 'form': form})\n</code></pre>"},{"location":"modules/blog.html#blog.views.PostUpdateView","title":"<code>blog.views.PostUpdateView</code>","text":"<p>               Bases: <code>LoginRequiredMixin</code>, <code>UserPassesTestMixin</code>, <code>SuccessMessageMixin</code>, <code>UpdateView</code></p> Source code in <code>blog/views.py</code> <pre><code>class PostUpdateView(LoginRequiredMixin, UserPassesTestMixin, SuccessMessageMixin, UpdateView):\n    model = Post\n    template_name = 'post_update.html'\n    form_class = PostAddForm\n    success_message = \"Poprawnie zmieniono informacje\"\n\n    def get_success_url(self):\n        return reverse_lazy('post_list_view')\n\n    def get_form_kwargs(self, **kwargs):\n        \"\"\" Passes the request object to the form class.\n         This is necessary to only display members that belong to a given user\"\"\"\n\n        kwargs = super(PostUpdateView, self).get_form_kwargs()\n        kwargs.update({'current_user': self.request.user})\n        return kwargs\n\n    def form_valid(self, form):\n        form.instance.save()\n        return super().form_valid(form)\n\n    def test_func(self):\n        post = self.get_object()\n        try:\n            if self.request.user == post.author:\n                if post.is_active:\n                    return True\n        except Exception:\n            return False\n        return False\n</code></pre>"},{"location":"modules/blog.html#blog.views.PostUpdateView.get_form_kwargs","title":"<code>get_form_kwargs(**kwargs)</code>","text":"<p>Passes the request object to the form class. This is necessary to only display members that belong to a given user</p> Source code in <code>blog/views.py</code> <pre><code>def get_form_kwargs(self, **kwargs):\n    \"\"\" Passes the request object to the form class.\n     This is necessary to only display members that belong to a given user\"\"\"\n\n    kwargs = super(PostUpdateView, self).get_form_kwargs()\n    kwargs.update({'current_user': self.request.user})\n    return kwargs\n</code></pre>"},{"location":"modules/blog.html#blog.views.PostDeleteView","title":"<code>blog.views.PostDeleteView</code>","text":"<p>               Bases: <code>LoginRequiredMixin</code>, <code>View</code></p> Source code in <code>blog/views.py</code> <pre><code>class PostDeleteView(LoginRequiredMixin, View):\n    def get(self, request, pk):\n        return redirect('post_list_view')\n\n    def post(self, request, pk):\n        post = get_object_or_404(Post, id=int(pk))\n        if post.author == request.user:\n            post.is_active = False\n            post.save()\n            messages.success(request, 'Poprawnie usuni\u0119to wydarzenie')\n            return redirect('post_list_view')\n        raise PermissionDenied\n</code></pre>"},{"location":"modules/calendar_app.html","title":"\ud83d\udcc5 Calendar (Kalendarz)","text":""},{"location":"modules/calendar_app.html#modu-kalendarza-i-obecnosci-calendar-app","title":"\ud83d\udcc5 Modu\u0142 Kalendarza i Obecno\u015bci (Calendar App)","text":"<p>Modu\u0142 <code>calendar_app</code> odpowiada za interaktywn\u0105 wizualizacj\u0119 obecno\u015bci dzieci oraz zarz\u0105dzanie harmonogramem pracy plac\u00f3wki. Integruje on dane o podopiecznyc&gt;</p>"},{"location":"modules/calendar_app.html#logika-biznesowa","title":"Logika Biznesowa","text":"<ul> <li>Interaktywny Kalendarz: System generuje dynamiczny kalendarz (<code>HTMLCalendar</code>), kt\u00f3ry nanosi kolory na dni w zale\u017cno\u015bci od statusu obecno\u015bci dziecka (O&gt;</li> <li>Zarz\u0105dzanie Weekendami i \u015awi\u0119tami: Kalendarz automatycznie wykrywa weekendy oraz pobiera list\u0119 dni wolnych zdefiniowanych przez Dyrektora (`FreeDaysMo&gt;</li> <li>Proaktywne Planowanie: Rodzice maj\u0105 mo\u017cliwo\u015b\u0107 zg\u0142aszania nieobecno\u015bci z jednodniowym wyprzedzeniem, co pozwala kuchni (modu\u0142 <code>Meals</code>) na optymalizacj\u0119&gt;</li> </ul>"},{"location":"modules/calendar_app.html#instrukcja-obsugi-dla-rol-uzytkownikow","title":"Instrukcja obs\u0142ugi dla R\u00f3l U\u017cytkownik\u00f3w","text":""},{"location":"modules/calendar_app.html#dla-dyrektora-administratora","title":"\ud83c\udf93 Dla Dyrektora (Administratora)","text":"<ul> <li>Pe\u0142ny Nadz\u00f3r: Dyrektor ma wgl\u0105d w kalendarz ka\u017cdego dziecka w plac\u00f3wce. Mo\u017ce r\u0119cznie korygowa\u0107 b\u0142\u0119dnie wprowadzone statusy obecno\u015bci w dowolnym dniu.</li> <li>Statystyki Zbiorcze: Widok <code>PresenceCalendarView</code> pozwala Dyrektorowi zobaczy\u0107 list\u0119 wszystkich dzieci w przedszkolu wraz z ich aktualnym statusem na &gt;</li> </ul>"},{"location":"modules/calendar_app.html#dla-nauczyciela","title":"\ud83d\udc69\ud83c\udfeb Dla Nauczyciela","text":"<ul> <li>Zarz\u0105dzanie Grup\u0105: Nauczyciel ma dost\u0119p do kalendarzy wy\u0142\u0105cznie tych dzieci, kt\u00f3re s\u0105 przypisane do jego grupy.</li> <li>Szybkie Sprawdzanie Listy: W widoku <code>PresenceCalendarView</code> nauczyciel widzi list\u0119 obecno\u015bci tylko dla swojej grupy, co pozwala na b\u0142yskawiczne \"odfajk&gt;</li> </ul>"},{"location":"modules/calendar_app.html#dla-rodzica","title":"\ud83d\udc6a Dla Rodzica","text":"<ul> <li>Zg\u0142aszanie Nieobecno\u015bci: Rodzic mo\u017ce samodzielnie zmieni\u0107 status obecno\u015bci swojego dziecka, ale system ogranicza t\u0119 akcj\u0119 do **nast\u0119pnego dnia robocze&gt;</li> <li>Podgl\u0105d Miesi\u0119czny: Rodzic widzi kolorow\u0105 histori\u0119 obecno\u015bci dziecka, co pomaga w monitorowaniu wykorzystanych dni z planu p\u0142atniczego.</li> </ul>"},{"location":"modules/calendar_app.html#dokumentacja-techniczna","title":"Dokumentacja Techniczna","text":""},{"location":"modules/calendar_app.html#calendar_app.views.Calendar","title":"<code>calendar_app.views.Calendar</code>","text":"<p>               Bases: <code>HTMLCalendar</code></p> Source code in <code>calendar_app/views.py</code> <pre><code>class Calendar(HTMLCalendar):\n    def __init__(self, year=None, month=None, director=None, kid=None):\n        self.year = year\n        self.month = month\n        self.director = director\n        self.kid = kid\n        super(Calendar, self).__init__()\n\n    # formats a day as a td\n    # filter events by day\n    def formatday(self, day, events):\n        events_per_day = events.filter(start_time__day=day)\n        d = ''\n        for event in events_per_day:\n            d += f'&lt;li&gt; {event.title} &lt;/li&gt;'\n\n        presences = PresenceModel.objects.filter(kid=self.kid)\n\n        if day != 0:\n            if calendar.weekday(year=self.year, month=self.month, day=day) == 5 or calendar.weekday(year=self.year,\n                                                                                                    month=self.month,\n                                                                                                    day=day) == 6:\n                return f\"&lt;td id='freeday' style='color: #E6DCD3'&gt;&lt;span class='date'&gt;{day}&lt;/span&gt;&lt;/td&gt;\"\n            for presence in presences:\n\n                if day == presence.day.day and self.month == presence.day.month and self.year == presence.day.year:\n                    if presence.presenceType == 1:\n                        return f\"&lt;td id='days' style='background-color: #FF5F57'&gt;&lt;span class='date'&gt;{day}&lt;/span&gt;&lt;/td&gt;\"\n                    elif presence.presenceType == 2:\n                        return f\"&lt;td id='days' style='background-color: #A5FE90'&gt;&lt;span class='date'&gt;{day}&lt;/span&gt;&lt;/td&gt;\"\n                    elif presence.presenceType == 3:\n                        return f\"&lt;td id='days' style='background-color: #B4F3F5'&gt;&lt;span class='date table-info'&gt;{day}&lt;/span&gt;&lt;/td&gt;\"\n            return f\"&lt;td id='days'&gt;&lt;span class='date'&gt;{day}&lt;/span&gt;&lt;/td&gt;\"\n        return f'&lt;td&gt;&lt;/td&gt;'\n\n    # formats a week as a tr\n    def formatweek(self, theweek, events):\n        week = ''\n        for d, weekday in theweek:\n            week += self.formatday(d, events)\n        return f\"&lt;tr class='test'&gt; {week} &lt;/tr&gt;\"\n\n    # formats a month as a table\n    # filter events by year and month\n    def formatmonth(self, withyear=True):\n        events = FreeDaysModel.objects.filter(principal=self.director).filter(start_time__year=self.year,\n                                                                              start_time__month=self.month)\n\n        cal = f'&lt;table border=\"0\" cellpadding=\"21\" cellspacing=\"21\" align=\"center\" class=\"calendar\"&gt;\\n'\n        cal += f'{self.formatmonthname(self.year, self.month, withyear=withyear)}\\n'\n        cal += f'{self.formatweekheader()}\\n'\n        for week in self.monthdays2calendar(self.year, self.month):\n            cal += f'{self.formatweek(week, events)}\\n'\n        return cal\n</code></pre>"},{"location":"modules/calendar_app.html#calendar_app.views.CalendarKid","title":"<code>calendar_app.views.CalendarKid</code>","text":"<p>               Bases: <code>LoginRequiredMixin</code>, <code>View</code></p> Source code in <code>calendar_app/views.py</code> <pre><code>class CalendarKid(LoginRequiredMixin, View):\n    def get(self, request, pk, month, year):\n        permissions = request.user.get_user_permissions()\n        kid = get_object_or_404(Kid, id=int(pk))\n        month_number = int(month)\n        year_number = int(year)\n        day_current = int(timezone.now().day)\n        month_next = month_number + 1\n        year_previous = year_number\n        year_next = year_number\n        month_previous = month_number - 1\n        if month_number == 12:\n            month_next = 1\n            year_next = year_number + 1\n        elif month_number == 1:\n            year_previous = year_number - 1\n            month_previous = 12\n        cal = Calendar(year=year_number, month=month_number, kid=kid).formatmonth(\n            withyear=True)\n        context = {'cal': mark_safe(cal), 'day_current': day_current, 'kid': kid, 'month': month_number,\n                   'year': year, 'month_next': month_next, 'year_next': year_next,\n                   'month_previous': month_previous, 'year_previous': year_previous}\n        if not kid.is_active:\n            raise PermissionDenied\n        elif permissions == {'director.is_director'}:\n            director = get_object_or_404(Director, user=request.user.id)\n            if kid.principal == director:\n                return render(request, 'calendar.html',\n                              context=context)\n        elif permissions == {'teacher.is_teacher'}:\n            teacher = get_object_or_404(Employee, user=request.user.id)\n            kids = list(teacher.group.kid_set.filter(is_active=True))\n            if kid in kids:\n                return render(request, 'calendar.html',\n                              context=context)\n        elif permissions == {'parent.is_parent'}:\n            parent = get_object_or_404(ParentA, user=request.user.id)\n            parent_kids = list(parent.kids.filter(is_active=True))\n            if kid in parent_kids:\n                return render(request, 'calendar.html',\n                              context=context)\n            raise PermissionDenied\n\n    def post(self, request, pk, month, year):\n        presence = request.POST.get('presence')\n        presence = presence.split(' ')\n        presence_type = presence.pop(-1)\n        month_name = presence[1]\n        month_number = datetime.strptime(month_name, '%B').month\n        presence[1] = f'{month_number}'\n        presence.reverse()\n        presence = '-'.join(presence)\n        presence_type = presenceChoices[int(presence_type)][0]\n        kid = get_object_or_404(Kid, id=int(pk))\n        test = PresenceModel.objects.filter(kid=kid).filter(day=presence).first()\n        if test:\n            test.presenceType = presence_type\n            test.save()\n        else:\n            PresenceModel.objects.create(day=presence, kid=kid, presenceType=presence_type)\n        messages.success(request, f\"Zmieniono obecnosc\")\n        return redirect('calendar', pk=pk, month=month, year=year)\n</code></pre>"},{"location":"modules/calendar_app.html#calendar_app.views.PresenceCalendarView","title":"<code>calendar_app.views.PresenceCalendarView</code>","text":"<p>               Bases: <code>LoginRequiredMixin</code>, <code>View</code></p> Source code in <code>calendar_app/views.py</code> <pre><code>class PresenceCalendarView(LoginRequiredMixin, View):\n    def get(self, request):\n        user = request.user\n        month = int(timezone.now().month)\n        year = int(timezone.now().year)\n        day = int(timezone.now().day)\n        if calendar.weekday(year=year, month=month, day=day) == 5 or calendar.weekday(year=year,\n                                                                                      month=month,\n                                                                                      day=day) == 6:\n            return render(request, 'presence-calendar.html',\n                          {'weekend': True})\n        elif user.get_user_permissions() == {'director.is_director'}:\n            director = get_object_or_404(Director, user=user.id)\n            kids = director.kid_set.filter(is_active=True).order_by('-id')\n\n        elif user.get_user_permissions() == {'teacher.is_teacher'}:\n            teacher = get_object_or_404(Employee, user=user.id)\n            director = teacher.principal.first()\n            kids = teacher.group.kid_set.filter(is_active=True).order_by('-id')\n        elif user.get_user_permissions() == {'parent.is_parent'}:\n            parent = get_object_or_404(ParentA, user=user.id)\n            director = parent.principal.first()\n            kids = parent.kids.filter(is_active=True).order_by('-id')\n        else:\n            raise PermissionDenied\n        kids_presence = PresenceModel.objects.filter(day=timezone.now()).filter(kid__principal=director).filter(\n            presenceType=2)\n        kids_absent = PresenceModel.objects.filter(day=timezone.now()).filter(kid__principal=director).filter(\n            presenceType=1)\n        kids_planned_absent = PresenceModel.objects.filter(day=timezone.now()).filter(\n            kid__principal=director).filter(\n            presenceType=3)\n        today = timezone.now().strftime(\"%Y-%m-%d\")\n        dict = {}\n        for kid in kids:\n            presence = PresenceModel.objects.filter(kid=kid).filter(day=timezone.now()).first()\n            dict[kid] = presence\n\n        paginator = Paginator(kids, 10)\n        page = request.GET.get('page')\n        page_obj = paginator.get_page(page)\n        tomorrow = (timezone.now() + timedelta(days=1)).weekday()\n        return render(request, 'presence-calendar.html',\n                      {'page_obj': page_obj,\n                       'today': today,\n                       'kids_presence': kids_presence,\n                       'kids_absent': kids_absent,\n                       'kids_planned_absent': kids_planned_absent,\n                       'dict': dict,\n                       'year': year,\n                       'month': month,\n                       'tomorrow': tomorrow\n                       })\n\n    def post(self, request):\n        data = request.POST.get('data')\n        data = data.split()\n        user = request.user.get_user_permissions()\n        kid_id = data[0]\n        type = data[1]\n        day = timezone.now().strftime(\"%Y-%m-%d\")\n        kid = Kid.objects.filter(id=int(kid_id)).filter(is_active=True).first()\n        check = PresenceModel.objects.filter(kid=kid).filter(day=day).first()\n        if user == {'parent.is_parent'}:\n            if kid:\n                if request.user.email in kid.parenta_set.values_list('user__email', flat=True):\n                    day = (timezone.now() + timedelta(days=1)).strftime(\"%Y-%m-%d\")\n                    check = PresenceModel.objects.filter(kid=kid).filter(day=day).first()\n                    if check:\n                        check.presenceType = int(type)\n                        check.save()\n                    else:\n                        PresenceModel.objects.create(day=day, kid=kid, presenceType=int(type))\n        elif user == {'director.is_director'}:\n            director = Director.objects.get(user=request.user.id)\n            if kid:\n                if kid.id in director.kid_set.filter(is_active=True).values_list('id', flat=True):\n                    if check:\n                        check.presenceType = int(type)\n                        check.save()\n                    else:\n                        PresenceModel.objects.create(day=day, kid=kid, presenceType=int(type))\n        elif user == {'teacher.is_teacher'}:\n            if kid in request.user.employee.group.kid_set.filter(is_active=True):\n                if check:\n                    check.presenceType = int(type)\n                    check.save()\n                else:\n                    PresenceModel.objects.create(day=day, kid=kid, presenceType=int(type))\n\n        return redirect('presence_calendar')\n</code></pre>"},{"location":"modules/calendar_app.html#statusy-obecnosci-w-kalendarzu","title":"Statusy Obecno\u015bci w Kalendarzu:","text":"<ul> <li>\ud83d\udfe5 Czerwony (Typ 1): Nieobecno\u015b\u0107 nieusprawiedliwiona.</li> <li>\ud83d\udfe9 Zielony (Typ 2): Obecno\u015b\u0107 dziecka w plac\u00f3wce.</li> <li>\ud83d\udfe6 Niebieski (Typ 3): Nieobecno\u015b\u0107 planowana (zg\u0142oszona przez rodzica).</li> <li>\ud83d\udcc1 Szary: Dni wolne od pracy przedszkola / weekendy.</li> </ul> <pre><code>erDiagram\n    %% CORE TABLE: Presence Tracking (from Children app)\n    CHILDREN_KID ||--o{ CHILDREN_PRESENCEMODEL : \"OneToMany, Zapis obecno\u015bci\"\n\n    CHILDREN_PRESENCEMODEL {\n        bigint id PK\n        bigint kid_id FK\n        date day\n        integer presenceType \"1:Nieobecny, 2:Obecny, 3:Planowana\"\n    }\n\n    %% RELATIONSHIP: Free Days/Holidays (from Director app)\n    DIRECTOR_DIRECTOR ||--o{ DIRECTOR_FREEDAYSMODEL : \"OneToMany, Dni wolne\"\n\n    DIRECTOR_FREEDAYSMODEL {\n        bigint id PK\n        bigint principal_id FK\n        varchar title\n        timestamp start_time\n        timestamp end_time\n    }</code></pre>"},{"location":"modules/children.html","title":"\ud83d\udc76 Children (Dzieci)","text":""},{"location":"modules/children.html#modu-dzieci-children","title":"\ud83d\udc76 Modu\u0142 Dzieci (Children)","text":"<p>Modu\u0142 ten stanowi centralny punkt systemu, integruj\u0105c dane osobowe podopiecznych z logik\u0105 finansow\u0105, organizacyjn\u0105 oraz \u017cywieniow\u0105 plac\u00f3wki.</p>"},{"location":"modules/children.html#logika-biznesowa-integracja-i-bezpieczenstwo","title":"Logika Biznesowa (Integracja i Bezpiecze\u0144stwo)","text":"<ul> <li>Sp\u00f3jno\u015b\u0107 danych (Integracja): Ka\u017cdy profil dziecka (<code>Kid</code>) jest nierozerwalnie po\u0142\u0105czony z konkretnym planem p\u0142atniczym, modelem \u017cywienia oraz grup\u0105 p&gt;</li> <li>Zaawansowany System Obecno\u015bci: Model <code>PresenceModel</code> monitoruje frekwencj\u0119, rozr\u00f3\u017cniaj\u0105c cztery stany: obecno\u015b\u0107, nieobecno\u015b\u0107 nieusprawiedliwion\u0105, plan&gt;</li> <li>Izolacja Uprawnie\u0144 (Widoczno\u015b\u0107):<ul> <li>Dyrektor: Posiada pe\u0142ny wgl\u0105d w kartoteki wszystkich dzieci zarejestrowanych w jego plac\u00f3wce.</li> <li>Nauczyciel: Ma dost\u0119p wy\u0142\u0105cznie do danych dzieci przypisanych do grupy, kt\u00f3r\u0105 zarz\u0105dza.</li> <li>Rodzic: Widzi wy\u0142\u0105cznie dane i histori\u0119 obecno\u015bci w\u0142asnych dzieci.</li> </ul> </li> </ul>"},{"location":"modules/children.html#workflow-przykad-uzycia","title":"\ud83d\udd04 Workflow / Przyk\u0142ad u\u017cycia:","text":""},{"location":"modules/children.html#scenariusz-przyjecie-nowego-dziecka-do-placowki","title":"\ud83c\udf93 Scenariusz: Przyj\u0119cie nowego dziecka do plac\u00f3wki","text":"<ul> <li>Akcja: Dyrektor rejestruje nowego podopiecznego za pomoc\u0105 <code>AddKidView</code>.</li> <li>Kluczowa Walidacja: System blokuje proces, je\u015bli w plac\u00f3wce nie zdefiniowano wcze\u015bniej przynajmniej jednej grupy, posi\u0142ku lub planu p\u0142atniczego. Gwara&gt;</li> <li>Efekt: Po zapisaniu, dziecko staje si\u0119 widoczne dla przypisanego nauczyciela oraz rodzic\u00f3w, a system kalendarza (<code>Calendar App</code>) zaczyna generowa\u0107 dla&gt;</li> </ul>"},{"location":"modules/children.html#scenariusz-zarzadzanie-grupa-i-weryfikacja-danych","title":"\ud83d\udc69\ud83c\udfeb Scenariusz: Zarz\u0105dzanie grup\u0105 i weryfikacja danych","text":"<ul> <li>Akcja: Nauczyciel wchodzi w <code>KidsListView</code>.</li> <li>Dzia\u0142anie: System automatycznie filtruje list\u0119, wy\u015bwietlaj\u0105c tylko podopiecznych z grupy nauczyciela. Nauczyciel mo\u017ce sprawdzi\u0107 status obecno\u015bci lub w&gt;</li> </ul>"},{"location":"modules/children.html#dokumentacja-techniczna","title":"Dokumentacja Techniczna","text":""},{"location":"modules/children.html#children.models.Kid","title":"<code>children.models.Kid</code>","text":"<p>               Bases: <code>Model</code></p> Source code in <code>children/models.py</code> <pre><code>class Kid(models.Model):\n    gender_choices = ((1, 'Ch\u0142opiec'), (2, 'Dziewczynka'))\n    date_of_birth = models.DateField(null=True)\n    first_name = models.CharField(max_length=128)\n    last_name = models.CharField(max_length=128)\n    group = models.ForeignKey(Groups, on_delete=models.CASCADE, null=True)\n    gender = models.IntegerField(choices=gender_choices, default=1)\n    start = models.DateField(auto_created=True)\n    end = models.DateField(null=True)\n    payment_plan = models.ForeignKey(PaymentPlan, on_delete=models.CASCADE, null=True)\n    amount = models.DecimalField(max_digits=20, decimal_places=2, null=True)\n    kid_meals = models.ForeignKey(Meals, on_delete=models.CASCADE, null=True)\n    principal = models.ForeignKey(Director, on_delete=models.CASCADE, null=True)\n    is_active = models.BooleanField(default=True)\n\n    def years_old(self):\n        return timezone.now().year - self.date_of_birth.year\n\n    def __str__(self):\n        \"\"\"\n        String representation\n        \"\"\"\n        return f'{self.first_name.title()} {self.last_name.title()}'\n</code></pre>"},{"location":"modules/children.html#children.models.Kid.__str__","title":"<code>__str__()</code>","text":"<p>String representation</p> Source code in <code>children/models.py</code> <pre><code>def __str__(self):\n    \"\"\"\n    String representation\n    \"\"\"\n    return f'{self.first_name.title()} {self.last_name.title()}'\n</code></pre>"},{"location":"modules/children.html#children.models.PresenceModel","title":"<code>children.models.PresenceModel</code>","text":"<p>               Bases: <code>Model</code></p> Source code in <code>children/models.py</code> <pre><code>class PresenceModel(models.Model):\n    day = models.DateField(auto_created=True)\n    kid = models.ForeignKey(Kid, on_delete=models.CASCADE)\n    presenceType = models.IntegerField(choices=presenceChoices)\n</code></pre>"},{"location":"modules/children.html#children.views.AddKidView","title":"<code>children.views.AddKidView</code>","text":"<p>               Bases: <code>PermissionRequiredMixin</code>, <code>UserPassesTestMixin</code>, <code>SuccessMessageMixin</code>, <code>CreateView</code></p> Source code in <code>children/views.py</code> <pre><code>class AddKidView(PermissionRequiredMixin, UserPassesTestMixin, SuccessMessageMixin, CreateView):\n    permission_required = \"director.is_director\"\n    model = Kid\n    template_name = 'kid-add.html'\n    form_class = KidAddForm\n    success_url = reverse_lazy('list_kids')\n    success_message = \"Dodano poprawnie dziecko\"\n\n    def get_initial(self):\n        initial = super(AddKidView, self).get_initial()\n        initial = initial.copy()\n        initial['principal'] = Director.objects.get(user=self.request.user.id)\n        return initial\n\n    def get_form_kwargs(self, **kwargs):\n        \"\"\" Passes the request object to the form class.\n         This is necessary to only display members that belong to a given user\"\"\"\n\n        kwargs = super().get_form_kwargs()\n        kwargs['current_user'] = self.request.user\n        return kwargs\n\n    def get_form(self, form_class=None):\n        form = super().get_form(form_class)\n        form.fields['group'].required = False\n        form.fields['payment_plan'].required = False\n        form.fields['kid_meals'].required = False\n        form.fields['end'].required = False\n        return form\n\n    def form_valid(self, form):\n        if self.request.POST.get('indefinite'):\n            form.instance.end = None\n\n        kid = form.save(commit=False)  # pobieramy instancj\u0119\n        kid.save()  # zapisujemy w bazie\n\n        messages.success(self.request, self.success_message)\n        return super().form_valid(form)\n\n    def test_func(self):\n        director = get_object_or_404(Director, user=self.request.user.id)\n        if director.groups_set.filter(is_active=True):\n            if director.meals_set.filter(is_active=True):\n                if director.paymentplan_set.filter(is_active=True):\n                    return True\n        return False\n\n    def handle_no_permission(self):\n        director = get_object_or_404(Director, user=self.request.user.id)\n        if not director.groups_set.filter(is_active=True):\n            messages.error(self.request, 'Dodaj najpierw jakas grupe')\n            return redirect('add_group')\n        if not director.meals_set.filter(is_active=True):\n            messages.error(self.request, 'Dodaj najpierw jakis posilke')\n            return redirect('add_meal')\n        if not director.paymentplan_set.filter(is_active=True):\n            messages.error(self.request, 'Dodaj najpierw jakis plan platniczy')\n            return redirect('add_payment_plans')\n\n        return redirect('add_meal')\n</code></pre>"},{"location":"modules/children.html#children.views.AddKidView.get_form_kwargs","title":"<code>get_form_kwargs(**kwargs)</code>","text":"<p>Passes the request object to the form class. This is necessary to only display members that belong to a given user</p> Source code in <code>children/views.py</code> <pre><code>def get_form_kwargs(self, **kwargs):\n    \"\"\" Passes the request object to the form class.\n     This is necessary to only display members that belong to a given user\"\"\"\n\n    kwargs = super().get_form_kwargs()\n    kwargs['current_user'] = self.request.user\n    return kwargs\n</code></pre>"},{"location":"modules/children.html#children.views.KidsListView","title":"<code>children.views.KidsListView</code>","text":"<p>               Bases: <code>LoginRequiredMixin</code>, <code>View</code></p> Source code in <code>children/views.py</code> <pre><code>class KidsListView(LoginRequiredMixin, View):\n    def get(self, request):\n        if request.user.get_user_permissions() == {'director.is_director'}:\n            kids = get_object_or_404(Director, user=request.user.id).kid_set.filter(is_active=True).order_by('-id')\n            groups_count = Groups.objects.filter(principal=request.user.id, is_active=True).count()\n        elif request.user.get_user_permissions() == {'teacher.is_teacher'}:\n            groups = get_object_or_404(Employee, user=request.user.id).group\n            groups_count = groups.filter(is_active=True).count()\n            if groups.is_active:\n                kids = groups.kid_set.filter(is_active=True).order_by('-id')\n            else:\n                kids = None\n\n        elif request.user.get_user_permissions() == {'parent.is_parent'}:\n            kids = get_object_or_404(ParentA, user=request.user.id).kids.filter(is_active=True).order_by('-id')\n            groups_count = get_object_or_404(ParentA, user=request.user.id).kids.group.filter(is_active=True).count()\n        else:\n            raise PermissionDenied\n\n        paginator = Paginator(kids, 10)\n        kids_count = kids.count()\n        avg = 0\n        for kid in kids:\n            print(kid.date_of_birth)\n            avg += kid.years_old()\n        avg /= kids_count\n        page = request.GET.get('page')\n        page_obj = paginator.get_page(page)\n        month = int(timezone.now().month)\n        year = int(timezone.now().year)\n\n        return render(request, 'kids-list.html',\n                      {'page_obj': page_obj, 'month': month, 'year': year, 'total_kids': kids_count,\n                       'groups_count': groups_count, 'avg_age': avg})\n\n    def post(self, request):\n        search = request.POST.get('search')\n        if search:\n            if request.user.get_user_permissions() == {'director.is_director'}:\n                kids = get_object_or_404(Director, user=request.user.id).kid_set.filter(\n                    first_name__icontains=search).filter(\n                    is_active=True).order_by('-id')\n                groups_count = Groups.objects.filter(principal=request.user.id, is_active=True).count()\n            elif request.user.get_user_permissions() == {'teacher.is_teacher'}:\n                group = get_object_or_404(Employee, user=request.user.id).group\n                kids = group.kid_set.filter(first_name__icontains=search).filter(is_active=True).order_by('-id')\n                groups_count = groups.filter(is_active=True).count()\n            else:\n                raise PermissionDenied\n            kids_count = kids.count()\n            avg = 0\n            for kid in kids:\n                print(kid.date_of_birth)\n                avg += kid.years_old()\n            avg /= kids_count if kids_count &gt; 0 else 1\n            paginator = Paginator(kids, 10)\n            page = request.GET.get('page')\n            page_obj = paginator.get_page(page)\n            month = int(timezone.now().month)\n            year = int(timezone.now().year)\n            return render(request, 'kids-list.html',\n                          {'page_obj': page_obj, 'month': month, 'year': year, 'total_kids': kids_count,\n                           'groups_count': groups_count, 'avg_age': avg})\n        return redirect('list_kids')\n</code></pre>"},{"location":"modules/children.html#children.views.DetailsKidView","title":"<code>children.views.DetailsKidView</code>","text":"<p>               Bases: <code>LoginRequiredMixin</code>, <code>View</code></p> Source code in <code>children/views.py</code> <pre><code>class DetailsKidView(LoginRequiredMixin, View):\n\n    def get(self, request, pk):\n        kid = Kid.objects.filter(id=int(pk)).filter(is_active=True).first()\n        if kid:\n            meals = None\n            if kid.kid_meals:\n                if kid.kid_meals.is_active == True:\n                    meals = kid.kid_meals\n\n            if request.user.get_user_permissions() == {'director.is_director'}:\n                if kid.principal.user.email == request.user.email:\n                    return render(request, 'kid-details.html', {'kid': kid, 'meals': meals})\n            elif request.user.get_user_permissions() == {'teacher.is_teacher'}:\n                teachers = kid.group.employee_set.values_list('user__email', flat=True)\n                if request.user.email in teachers:\n                    return render(request, 'kid-details.html', {'kid': kid, 'meals': meals})\n            elif request.user.get_user_permissions() == {'parent.is_parent'}:\n                parents = kid.parenta_set.values_list('user__email', flat=True)\n                if request.user.email in parents:\n                    return render(request, 'kid-details.html', {'kid': kid, 'meals': meals})\n        raise PermissionDenied\n</code></pre>"},{"location":"modules/children.html#kluczowe-procesy-techniczne","title":"Kluczowe Procesy Techniczne:","text":"<ol> <li>Walidacja Tworzenia: Widok <code>AddKidView</code> wykonuje sprawdzenie <code>exists()</code> na modelach <code>Groups</code>, <code>Meals</code> i <code>PaymentPlan</code> powi\u0105zanych z dyrektorem przed &gt;</li> <li>Dynamiczny Wiek: Model <code>Kid</code> oblicza wiek w oparciu o dat\u0119 urodzenia, co pozwala na generowanie raport\u00f3w demograficznych bez konieczno\u015bci r\u0119cznej akt&gt;</li> <li>Zarz\u0105dzanie Opiekunami: System umo\u017cliwia elastyczne przypisywanie wielu rodzic\u00f3w do jednego profilu dziecka, co pozwala na obs\u0142ug\u0119 rozbudowanych stru&gt;</li> </ol> <pre><code>erDiagram\n    %% CORE TABLE: Kid Profile\n    DIRECTOR_DIRECTOR ||--o{ CHILDREN_KID : \"OneToMany, Nadzoruje\"\n    GROUPS_GROUPS ||--o{ CHILDREN_KID : \"ForeignKey, Przypisanie do Grupy\"\n    PAYMENTS_PLANS_PAYMENTPLAN ||--o{ CHILDREN_KID : \"ForeignKey, Plan P\u0142atniczy\"\n    MEALS_MEALS ||--o{ CHILDREN_KID : \"ForeignKey, Plan \u017bywieniowy\"\n\n    CHILDREN_KID ||--o{ CHILDREN_PRESENCEMODEL : \"OneToMany, Wpisy Obecno\u015bci\"\n    PARENT_PARENTA }o--|| CHILDREN_KID : \"ManyToMany, Opiekun\"\n\n    CHILDREN_KID {\n        bigint id PK\n        bigint principal_id FK\n        bigint group_id FK\n        bigint payment_plan_id FK\n        bigint kid_meals_id FK\n        date date_of_birth\n        varchar first_name\n        varchar last_name\n        integer gender\n        date start\n        date end \"NULLABLE\"\n        boolean is_active\n        numeric amount \"Kwota z planu p\u0142atniczego\"\n    }\n\n    %% DETAIL TABLE: Presence Tracking\n    CHILDREN_PRESENCEMODEL {\n        bigint id PK\n        bigint kid_id FK\n        date day\n        integer presenceType \"1:Nieobecny, 2:Obecny, 3:Planowana\"\n    }</code></pre>"},{"location":"modules/director.html","title":"\ud83c\udf93 Director (Dyrektor)","text":""},{"location":"modules/director.html#modu-dyrektora-director","title":"\ud83c\udf93 Modu\u0142 Dyrektora (Director)","text":"<p>Modu\u0142 ten s\u0142u\u017cy jako Centrum Dowodzenia i Zarz\u0105dzania Plac\u00f3wk\u0105. Dyrektor pe\u0142ni rol\u0119 g\u0142\u00f3wnego administratora, kontroluj\u0105c wszystkie dane, zasoby i konfig&gt;</p>"},{"location":"modules/director.html#logika-biznesowa-izolacja-danych","title":"Logika Biznesowa (Izolacja Danych)","text":"<ul> <li>Zarz\u0105dzanie W\u0142asn\u0105 Plac\u00f3wk\u0105: Wszystkie zasoby \u2013 od dzieci (<code>Kid</code>), przez posi\u0142ki (<code>Meals</code>), po zdj\u0119cia (<code>GroupPhotos</code>) \u2013 s\u0105 \u015bci\u015ble powi\u0105zane z obiekte&gt;</li> <li>Personalizacja Systemu: Dyrektor jako jedyny definiuje kluczowe elementy operacyjne, takie jak:<ul> <li>Standardy Graficzne: Zarz\u0105dzanie bibliotek\u0105 zdj\u0119\u0107 i ikon do identyfikacji grup i posi\u0142k\u00f3w.</li> <li>Dane Kontaktowe: Ustalanie oficjalnych danych teleadresowych plac\u00f3wki (<code>ContactModel</code>) z walidacj\u0105 format\u00f3w.</li> </ul> </li> </ul>"},{"location":"modules/director.html#workflow-przykad-uzycia","title":"\ud83d\udd04 Workflow / Przyk\u0142ad u\u017cycia:","text":""},{"location":"modules/director.html#dla-dyrektora-zarzadzanie-zasobami","title":"\ud83c\udf93 Dla Dyrektora (Zarz\u0105dzanie Zasobami)","text":"<ul> <li>Zadanie: Dyrektor chce zoptymalizowa\u0107 przestrze\u0144 dyskow\u0105, jednocze\u015bnie zachowuj\u0105c wysok\u0105 jako\u015b\u0107 wizualn\u0105.</li> <li>Dzia\u0142anie: Przy wgrywaniu zdj\u0119cia grupy (przez <code>PhotosAddView</code>), system automatycznie skaluje obraz do maksymalnych wymiar\u00f3w 300x300px, co poprawi&gt;</li> <li>Zadanie: Dyrektor chce delegowa\u0107 cz\u0119\u015b\u0107 obowi\u0105zk\u00f3w wicedyrektorowi.</li> <li>Dzia\u0142anie: Dyrektor u\u017cywa widoku <code>GiveDirectorPermissions</code>, aby nada\u0107 uprawnienia <code>is_director</code> innemu pracownikowi (<code>Employee</code>), kt\u00f3ry od tego moment&gt;</li> </ul>"},{"location":"modules/director.html#dokumentacja-techniczna","title":"Dokumentacja Techniczna","text":""},{"location":"modules/director.html#director.models.Director","title":"<code>director.models.Director</code>","text":"<p>               Bases: <code>Model</code></p> Source code in <code>director/models.py</code> <pre><code>class Director(models.Model):\n    gender_choices = ((1, 'Mezczyzna'), (2, 'Kobieta'))\n    first_name = models.CharField(max_length=128, null=True)\n    last_name = models.CharField(max_length=128, null=True)\n    user = models.OneToOneField(User, on_delete=models.CASCADE)\n    gender = models.IntegerField(choices=gender_choices, null=True)\n\n    class Meta:\n        permissions = [\n            (\"is_director\", \"Is the director of kindergarten\")\n        ]\n\n    def __str__(self):\n        return f\"{self.user.email}\"\n</code></pre>"},{"location":"modules/director.html#director.models.GroupPhotos","title":"<code>director.models.GroupPhotos</code>","text":"<p>               Bases: <code>Model</code></p> Source code in <code>director/models.py</code> <pre><code>class GroupPhotos(models.Model):\n    group_photos = models.ImageField(null=True, upload_to=user_group_path, unique=True)\n    principal = models.ForeignKey(Director, on_delete=models.CASCADE, null=True)\n    name = models.CharField(max_length=64, null=True)\n    is_active = models.BooleanField(default=True)\n    date_created = models.DateTimeField(auto_now_add=True, null=True)\n\n    def save(self, *args, **kwargs):\n        super().save(*args, **kwargs)\n        if self.group_photos:\n            img = Image.open(self.group_photos.path)\n\n            if img.height &gt; 300 or img.width &gt; 300:\n                output_size = (300, 300)\n                img.thumbnail(output_size)\n                img.save(self.group_photos.path)\n\n    def __str__(self):\n        return f'{self.group_photos.url}'\n</code></pre>"},{"location":"modules/director.html#director.models.ContactModel","title":"<code>director.models.ContactModel</code>","text":"<p>               Bases: <code>Model</code></p> Source code in <code>director/models.py</code> <pre><code>class ContactModel(models.Model):\n    director = models.OneToOneField(Director, on_delete=models.CASCADE)\n    email_address = models.EmailField(null=True)\n    phone_regex = RegexValidator(regex=r'^\\+?1?\\d{9,15}$',\n                                 message=\"Numer telefonu w formacie: '+99 999 999 999'\")\n    phone = models.CharField(null=True, unique=True, max_length=17, validators=[phone_regex])\n    localization = models.TextField(max_length=128, null=True)\n</code></pre>"},{"location":"modules/director.html#director.views.PhotosAddView","title":"<code>director.views.PhotosAddView</code>","text":"<p>               Bases: <code>PermissionRequiredMixin</code>, <code>View</code></p> Source code in <code>director/views.py</code> <pre><code>class PhotosAddView(PermissionRequiredMixin, View):\n    permission_required = \"director.is_director\"\n\n    def get(self, request):\n        return render(request, 'photo-add.html')\n\n    def post(self, request):\n        photo_type = request.POST.get('type')\n        file = request.FILES.get('file')\n        name = request.POST.get('name')\n        if not photo_type:\n            messages.error(request, 'Wybierz typ iconki')\n            return redirect('photo_add')\n        elif not file:\n            messages.error(request, 'Wybierz jakis plik')\n            return redirect('photo_add')\n        elif not name:\n            messages.error(request, 'Nazwa jest wymagana')\n            return redirect('photo_add')\n        if photo_type == 'group':\n            GroupPhotos.objects.create(group_photos=file, principal=request.user.director, name=name)\n        elif photo_type == 'meal':\n            MealPhotos.objects.create(meal_photos=file, principal=request.user.director, name=name)\n        messages.success(request, 'Poprawnie dodano ikonk\u0119')\n        return redirect('photos_list')\n</code></pre>"},{"location":"modules/director.html#director.views.GiveDirectorPermissions","title":"<code>director.views.GiveDirectorPermissions</code>","text":"<p>               Bases: <code>PermissionRequiredMixin</code>, <code>LoginRequiredMixin</code>, <code>View</code></p> Source code in <code>director/views.py</code> <pre><code>class GiveDirectorPermissions(PermissionRequiredMixin, LoginRequiredMixin, View):\n    permission_required = 'director.is_director'\n\n    def get(self, request):\n        employees = Employee.objects.filter(principal=Director.objects.get(user=request.user)).order_by('-id')\n        paginator = Paginator(employees, 10)\n        page = request.GET.get('page')\n        page_obj = paginator.get_page(page)\n        return render(request, 'give-director-permission.html', context={'page_obj': page_obj})\n\n    def post(self, request):\n        search = request.POST.get('search')\n        if search:\n            employees = Employee.objects.filter(principal=Director.objects.get(user=request.user)).filter(\n                user__email__icontains=search).order_by('-id')\n            paginator = Paginator(employees, 10)\n            page = request.GET.get('page')\n            page_obj = paginator.get_page(page)\n            return render(request, 'give-director-permission.html', context={'page_obj': page_obj})\n        content_type = ContentType.objects.get_for_model(Director)\n        permission = Permission.objects.get(content_type=content_type, codename='is_director')\n        pk = list(map(int, request.POST.getlist('pk')))\n        employees = Employee.objects.filter(id__in=pk)\n        for employee in employees:\n            employee.user.user_permissions.add(permission)\n\n        return redirect('give-permissions')\n</code></pre>"},{"location":"modules/director.html#kluczowe-zabezpieczenia","title":"Kluczowe Zabezpieczenia:","text":"<ul> <li>Weryfikacja W\u0142asno\u015bci: Ka\u017cdy widok w tym module rygorystycznie sprawdza, czy edytowany obiekt (np. zdj\u0119cie lub dane kontaktowe) nale\u017cy do zalogowanego&gt;</li> </ul> <pre><code>erDiagram\n    %% CORE TABLE: Director Profile\n    ACCOUNTS_USER ||--|| DIRECTOR_DIRECTOR : \"OneToOne, W\u0142a\u015bciciel\"\n\n    DIRECTOR_DIRECTOR {\n        bigint id PK\n        bigint user_id FK UK\n        varchar first_name\n        varchar last_name\n        integer gender\n    }\n\n    %% RELATIONSHIPS: Core Director Resources\n    DIRECTOR_DIRECTOR ||--|| DIRECTOR_CONTACTMODEL : \"OneToOne, Dane Plac\u00f3wki\"\n    DIRECTOR_DIRECTOR ||--o{ DIRECTOR_GROUPPHOTOS : \"OneToMany, Ikony Grup\"\n    DIRECTOR_DIRECTOR ||--o{ DIRECTOR_MEALPHOTOS : \"OneToMany, Ikony Posi\u0142k\u00f3w\"\n    DIRECTOR_DIRECTOR ||--o{ DIRECTOR_FREEDAYSMODEL : \"OneToMany, Dni Wolne\"\n    TEACHER_EMPLOYEE }o--|| DIRECTOR_DIRECTOR : \"ManyToMany, Prze\u0142o\u017cony\"\n    PARENT_PARENTA }o--|| DIRECTOR_DIRECTOR : \"ManyToMany, Nadz\u00f3r Rodzica\"\n\n    %% DETAIL TABLES\n    DIRECTOR_CONTACTMODEL {\n        bigint id PK\n        bigint director_id FK UK\n        varchar phone UK \"Walidacja REGEX\"\n        varchar email_address\n        text localization\n    }\n    DIRECTOR_GROUPPHOTOS {\n        bigint id PK\n        bigint principal_id FK\n        varchar group_photos UK \"Plik\"\n        varchar name\n    }\n    DIRECTOR_FREEDAYSMODEL {\n        bigint id PK\n        bigint principal_id FK\n        varchar title\n        timestamp start_time\n        timestamp end_time\n    }</code></pre>"},{"location":"modules/groups.html","title":"\ud83d\udc65 Groups (Grupy)","text":""},{"location":"modules/groups.html#modu-grup-groups","title":"\ud83d\udc65 Modu\u0142 Grup (Groups)","text":"<p>Modu\u0142 <code>groups</code> odpowiada za struktur\u0119 organizacyjn\u0105 przedszkola, dziel\u0105c dzieci i kadr\u0119 na konkretne oddzia\u0142y (np. grupy wiekowe).</p>"},{"location":"modules/groups.html#logika-biznesowa","title":"Logika Biznesowa","text":"<ul> <li>Pojemno\u015b\u0107 i Roczniki: Ka\u017cda grupa ma zdefiniowany rocznik oraz limit miejsc. Pozwala to na monitorowanie ob\u0142o\u017cenia plac\u00f3wki i planowanie zapis\u00f3w.</li> <li>Wizualna Identyfikacja: Grupy s\u0105 personalizowane za pomoc\u0105 ikon (zdj\u0119\u0107) zarz\u0105dzanych przez Dyrektora, co u\u0142atwia orientacj\u0119 w systemie zar\u00f3wno kadrze,&gt;</li> <li>Dynamiczne Zarz\u0105dzanie Sk\u0142adem: System umo\u017cliwia dyrektorowi szybkie przepisywanie dzieci oraz nauczycieli mi\u0119dzy grupami. Dzi\u0119ki zastosowaniu filtr\u00f3w&gt;</li> </ul>"},{"location":"modules/groups.html#dostep-do-danych-role","title":"Dost\u0119p do danych (Role)","text":"<ul> <li>\ud83c\udf93 Dyrektor: Posiada pe\u0142ne uprawnienia do tworzenia, edycji i usuwania grup oraz zarz\u0105dzania ich sk\u0142adem osobowym.</li> <li>\ud83d\udc69\ud83c\udfeb Nauczyciel: Ma wgl\u0105d w szczeg\u00f3\u0142y (list\u0119 dzieci, kalendarz) tylko tych grup, do kt\u00f3rych zosta\u0142 formalnie przypisany przez Dyrektora.</li> <li>\ud83d\udc6a Rodzic: Widzi jedynie podstawowe informacje o grupach, do kt\u00f3rych ucz\u0119szczaj\u0105 jego dzieci.</li> </ul>"},{"location":"modules/groups.html#workflow-przykad-uzycia","title":"\ud83d\udd04 Workflow / Przyk\u0142ad u\u017cycia:","text":""},{"location":"modules/groups.html#dla-dyrektora","title":"\ud83c\udf93 Dla Dyrektora","text":"<ul> <li>Zadanie: Utworzenie nowej grupy \"Pszcz\u00f3\u0142ki\" i przypisanie do niej kadry.</li> <li>Dzia\u0142anie: Dyrektor otwiera <code>GroupAddView</code>, wybiera ikon\u0119 z biblioteki <code>Director</code> i ustala limit miejsc (np. 25). Nast\u0119pnie u\u017cywa <code>AssignTeachersView</code>&gt;</li> </ul>"},{"location":"modules/groups.html#dla-nauczyciela","title":"\ud83d\udc69\ud83c\udfeb Dla Nauczyciela","text":"<ul> <li>Zadanie: Sprawdzenie listy dzieci w przypisanej grupie na pocz\u0105tku roku.</li> <li>Dzia\u0142anie: Nauczyciel loguje si\u0119 i w <code>GroupsListView</code> widzi tylko swoj\u0105 grup\u0119. Po wej\u015bciu w <code>GroupDetailsView</code> uzyskuje dost\u0119p do pe\u0142nej listy podopie&gt;</li> </ul>"},{"location":"modules/groups.html#dla-rodzica","title":"\ud83d\udc6a Dla Rodzica","text":"<ul> <li>Zadanie: Sprawdzenie sk\u0142adu grupy dziecka i personelu opieku\u0144czego.</li> <li>Dzia\u0142anie: Rodzic wchodzi w szczeg\u00f3\u0142y grupy swojego dziecka; widzi profil przypisanego nauczyciela oraz list\u0119 r\u00f3wie\u015bnik\u00f3w, z kt\u00f3rymi jego dziecko prze&gt;</li> </ul>"},{"location":"modules/groups.html#dokumentacja-techniczna","title":"Dokumentacja Techniczna","text":""},{"location":"modules/groups.html#groups.models.Groups","title":"<code>groups.models.Groups</code>","text":"<p>               Bases: <code>Model</code></p> Source code in <code>groups/models.py</code> <pre><code>class Groups(models.Model):\n    name = models.CharField(max_length=128)\n    principal = models.ForeignKey(Director, on_delete=models.CASCADE, null=True)\n    capacity = models.IntegerField(null=True, validators=[MinValueValidator(limit_value=1)])\n    photo = models.ForeignKey(GroupPhotos, on_delete=models.CASCADE, null=True)\n    is_active = models.BooleanField(default=True)\n    yearbook = models.IntegerField(null=True)\n\n    def __str__(self):\n        \"\"\"\n        String representation\n        \"\"\"\n        return f'{self.name}'\n    @property\n    def current_students_count(self):\n        \"\"\"\n        Zwraca aktualn\u0105 liczb\u0119 aktywnych dzieci w grupie.\n\n        Uwaga: Ta metoda jest szybka, ale nie powinna by\u0107 u\u017cywana w p\u0119tlach w szablonie,\n        je\u015bli QuerySet nie zosta\u0142 wcze\u015bniej wzbogacony przez .annotate() (jak robisz w GroupsListView).\n        \"\"\"\n        return self.kid_set.filter(is_active=True).count()\n\n    @property\n    def capacity_fill_percent(self):\n        \"\"\"\n        Oblicza procent wype\u0142nienia grupy. Zwraca 0, je\u015bli pojemno\u015b\u0107 nie jest ustawiona lub jest r\u00f3wna 0.\n        \"\"\"\n        if self.capacity and self.capacity &gt; 0:\n            count = self.current_students_count\n            # U\u017cyj atrybutu child_count je\u015bli QuerySet by\u0142 annotowany\n            if hasattr(self, 'child_count'):\n                count = self.child_count\n\n            return min(100, (count / self.capacity) * 100)\n        return 0\n\n    @property\n    def is_full(self):\n        \"\"\"\n        Sprawdza, czy grupa osi\u0105gn\u0119\u0142a maksymaln\u0105 pojemno\u015b\u0107.\n        \"\"\"\n        return self.current_students_count &gt;= self.capacity\n\n    def get_active_kids(self):\n        \"\"\"\n        Zwraca QuerySet aktywnych dzieci przypisanych do tej grupy.\n        \"\"\"\n        # Zak\u0142adam, \u017ce model dziecka ma ForeignKey do modelu Groups i nazywa si\u0119 'kid_set' (domy\u015blna nazwa).\n        return self.kid_set.filter(is_active=True).order_by('last_name', 'first_name')\n\n    # Przyk\u0142adowa metoda, je\u015bli potrzebujesz statusu wizualnego\n    def get_status_tag(self):\n        \"\"\"\n        Zwraca status grupy na podstawie jej aktywno\u015bci.\n        \"\"\"\n        if self.is_active:\n            return 'Aktywna'\n        return 'Archiwalna'\n</code></pre>"},{"location":"modules/groups.html#groups.models.Groups.capacity_fill_percent","title":"<code>capacity_fill_percent</code>  <code>property</code>","text":"<p>Oblicza procent wype\u0142nienia grupy. Zwraca 0, je\u015bli pojemno\u015b\u0107 nie jest ustawiona lub jest r\u00f3wna 0.</p>"},{"location":"modules/groups.html#groups.models.Groups.current_students_count","title":"<code>current_students_count</code>  <code>property</code>","text":"<p>Zwraca aktualn\u0105 liczb\u0119 aktywnych dzieci w grupie.</p> <p>Uwaga: Ta metoda jest szybka, ale nie powinna by\u0107 u\u017cywana w p\u0119tlach w szablonie, je\u015bli QuerySet nie zosta\u0142 wcze\u015bniej wzbogacony przez .annotate() (jak robisz w GroupsListView).</p>"},{"location":"modules/groups.html#groups.models.Groups.is_full","title":"<code>is_full</code>  <code>property</code>","text":"<p>Sprawdza, czy grupa osi\u0105gn\u0119\u0142a maksymaln\u0105 pojemno\u015b\u0107.</p>"},{"location":"modules/groups.html#groups.models.Groups.__str__","title":"<code>__str__()</code>","text":"<p>String representation</p> Source code in <code>groups/models.py</code> <pre><code>def __str__(self):\n    \"\"\"\n    String representation\n    \"\"\"\n    return f'{self.name}'\n</code></pre>"},{"location":"modules/groups.html#groups.models.Groups.get_active_kids","title":"<code>get_active_kids()</code>","text":"<p>Zwraca QuerySet aktywnych dzieci przypisanych do tej grupy.</p> Source code in <code>groups/models.py</code> <pre><code>def get_active_kids(self):\n    \"\"\"\n    Zwraca QuerySet aktywnych dzieci przypisanych do tej grupy.\n    \"\"\"\n    # Zak\u0142adam, \u017ce model dziecka ma ForeignKey do modelu Groups i nazywa si\u0119 'kid_set' (domy\u015blna nazwa).\n    return self.kid_set.filter(is_active=True).order_by('last_name', 'first_name')\n</code></pre>"},{"location":"modules/groups.html#groups.models.Groups.get_status_tag","title":"<code>get_status_tag()</code>","text":"<p>Zwraca status grupy na podstawie jej aktywno\u015bci.</p> Source code in <code>groups/models.py</code> <pre><code>def get_status_tag(self):\n    \"\"\"\n    Zwraca status grupy na podstawie jej aktywno\u015bci.\n    \"\"\"\n    if self.is_active:\n        return 'Aktywna'\n    return 'Archiwalna'\n</code></pre>"},{"location":"modules/groups.html#groups.forms.GroupsForm","title":"<code>groups.forms.GroupsForm</code>","text":"<p>               Bases: <code>ModelForm</code></p> Source code in <code>groups/forms.py</code> <pre><code>class GroupsForm(forms.ModelForm):\n    class Meta:\n        model = Groups\n        fields = '__all__'\n        widgets = {\n            'principal': forms.HiddenInput,\n        }\n        labels = {\n            'name': 'Nazwa:',\n            'capacity': 'Pojemno\u015b\u0107:',\n            'yearbook': \"Rocznik:\"\n        }\n\n    def __init__(self, *args, current_user=None, **kwargs):\n        super().__init__(*args, **kwargs)\n        if current_user is not None:\n            self.fields['photo'] = forms.ModelChoiceField(\n                queryset=Director.objects.get(user=current_user.id).groupphotos_set.filter(is_active=True))\n</code></pre>"},{"location":"modules/groups.html#groups.views.GroupAddView","title":"<code>groups.views.GroupAddView</code>","text":"<p>               Bases: <code>PermissionRequiredMixin</code>, <code>View</code></p> Source code in <code>groups/views.py</code> <pre><code>class GroupAddView(PermissionRequiredMixin, View):\n    permission_required = \"director.is_director\"\n\n    def get(self, request):\n        director = Director.objects.get(user=request.user.id)\n        photos = director.groupphotos_set.filter(is_active=True)\n        if photos:\n            return render(request, 'group-add.html', {'photos': photos})\n        messages.info(request, 'Najpierwsz musisz dodac jakas iconke')\n        return redirect('photo_add')\n\n    def post(self, request):\n        director = Director.objects.get(user=request.user.id)\n        photo_id = request.POST.get('photo')\n        name = request.POST.get('name')\n        capacity = request.POST.get('capacity')\n        yearbook = request.POST.get('yearbook')\n        if photo_id and name and capacity and yearbook:\n            if '-' in capacity:\n                messages.error(request, 'pojemnosc nie moze byc ujemna')\n                return redirect('add_group')\n            else:\n                image = get_object_or_404(GroupPhotos, id=int(photo_id))\n                new_group = Groups.objects.create(name=name, capacity=int(capacity), principal=director, photo=image,\n                                                  yearbook=yearbook)\n\n                messages.success(request, f'poprawnie dodano grupe o nazwie {new_group.name}')\n                return redirect('list_groups')\n        messages.error(request, 'Wszystkie pola musza byc wypelnione')\n        return redirect('add_group')\n</code></pre>"},{"location":"modules/groups.html#groups.views.GroupsListView","title":"<code>groups.views.GroupsListView</code>","text":"<p>               Bases: <code>LoginRequiredMixin</code>, <code>View</code></p> Source code in <code>groups/views.py</code> <pre><code>class GroupsListView(LoginRequiredMixin, View):\n    def get(self, request):\n        user = request.user\n        groups_qs = Groups.objects.none()  # Inicjalizacja pustym QuerySetem\n        search_query = request.GET.get('q', '')  # 1. Pobieramy fraz\u0119 wyszukiwania\n\n        # Utworzenie filtru bazowego (zale\u017cnego od roli)\n        if user.get_user_permissions() == {'director.is_director'}:\n            try:\n                # Pobieramy ID grup nale\u017c\u0105cych do dyrektora\n                group_ids = Director.objects.get(user=user).groups_set.filter(is_active=True).values_list('id',\n                                                                                                          flat=True)\n                groups_qs = Groups.objects.filter(id__in=group_ids)\n            except Director.DoesNotExist:\n                pass\n\n        elif user.get_user_permissions() == {'parent.is_parent'}:\n            try:\n                # Pobieramy ID grup, do kt\u00f3rych nale\u017c\u0105 dzieci rodzica\n                group_ids = ParentA.objects.get(user=user).kids.filter(is_active=True).values_list('group_id',\n                                                                                                   flat=True).distinct()\n                groups_qs = Groups.objects.filter(id__in=group_ids)\n            except ParentA.DoesNotExist:\n                pass\n\n        else:\n            raise PermissionDenied\n\n        # 2. Aplikacja wyszukiwania (je\u015bli fraza nie jest pusta)\n        if search_query:\n            # Filtrowanie po nazwie grupy (case-insensitive contains)\n            groups_qs = groups_qs.filter(\n                name__icontains=search_query\n            )\n\n        # 3. Dodanie adnotacji z licznikiem dzieci\n        groups_qs = groups_qs.annotate(\n            child_count=Count('kid', filter=Q(kid__is_active=True))\n        ).order_by('-id')\n\n        groups = groups_qs  # Zmieniamy nazw\u0119 zmiennej dla czytelno\u015bci\n\n        # Paginacja\n        paginator = Paginator(groups, 3)\n        page = request.GET.get('page')\n        page_obj = paginator.get_page(page)\n\n        return render(request, 'groups-list.html', {\n            'page_obj': page_obj,\n            'search_query': search_query  # Przekazujemy fraz\u0119 wyszukiwania do szablonu\n        })\n</code></pre>"},{"location":"modules/groups.html#groups.views.GroupDetailsView","title":"<code>groups.views.GroupDetailsView</code>","text":"<p>               Bases: <code>LoginRequiredMixin</code>, <code>View</code></p> Source code in <code>groups/views.py</code> <pre><code>class GroupDetailsView(LoginRequiredMixin, View):\n    def get(self, request, pk):\n        group = get_object_or_404(Groups, id=int(pk))\n        teachers_test = list(group.employee_set.values_list(\"user__email\", flat=True))\n        teachers = group.employee_set.all()\n\n        # Pobieranie frazy wyszukiwania z URL\n        search_query = request.GET.get('q', '').strip()\n\n        # Pobieranie wszystkich aktywnych dzieci z grupy\n        kids_qs = group.kid_set.filter(is_active=True)\n\n        # --- APLIKACJA WYSZUKIWANIA ---\n        if search_query:\n            kids_qs = kids_qs.filter(\n                Q(first_name__icontains=search_query) |\n                Q(last_name__icontains=search_query)\n            )\n            print(kids_qs)\n        # -------------------------------\n\n        # Finalna lista dzieci do przekazania\n        kids = kids_qs\n        print(kids)\n\n        month = int(timezone.now().month)\n        year = int(timezone.now().year)\n\n        # Sprawdzenie uprawnie\u0144 i renderowanie\n        if request.user.get_user_permissions() == {'teacher.is_teacher'}:\n            # ... (Logika nauczyciela) ...\n            teacher_email = Employee.objects.get(user=request.user.id).user.email\n            if teacher_email in teachers_test:\n                return render(request, 'group-details.html',\n                              {'group': group, 'teachers': teachers, 'kids': kids, 'month': month, 'year': year,\n                               'search_query': search_query})\n\n        elif request.user.get_user_permissions() == {'director.is_director'}:\n            # ... (Logika dyrektora) ...\n            director = Director.objects.get(user=request.user.id)\n            if director == group.principal:\n                return render(request, 'group-details.html',\n                              {'group': group, 'teachers': teachers, 'kids': kids, 'month': month, 'year': year,\n                               'search_query': search_query})\n\n        elif request.user.get_user_permissions() == {'parent.is_parent'}:\n            # ... (Logika rodzica) ...\n            parent = ParentA.objects.get(user=request.user.id)\n            parent_kids = parent.kids.filter(is_active=True)\n            allow = False\n            for kid in parent_kids:\n                # Sprawdzenie, czy przefiltrowana lista dzieci zawiera kt\u00f3re\u015b z dzieci rodzica\n                # Wa\u017cne: Sprawdzenie 'if kid in kids:' jest nieoptymalne, ale zgodne z Twoj\u0105 logik\u0105.\n                # W praktyce lepiej sprawdzi\u0107, czy rodzic ma dzieci w danej grupie.\n                if kid in kids:\n                    allow = True\n                    break\n            if allow:\n                return render(request, 'group-details.html',\n                              {'group': group, 'teachers': teachers, 'kids': kids, 'month': month, 'year': year,\n                               'search_query': search_query})\n\n        raise PermissionDenied\n</code></pre>"},{"location":"modules/groups.html#groups.views.AssignExistingKidToGroupView","title":"<code>groups.views.AssignExistingKidToGroupView</code>","text":"<p>               Bases: <code>LoginRequiredMixin</code>, <code>PermissionRequiredMixin</code>, <code>View</code></p> Source code in <code>groups/views.py</code> <pre><code>class AssignExistingKidToGroupView(LoginRequiredMixin, PermissionRequiredMixin, View):\n    permission_required = 'director.is_director'\n    template_name = 'kid_assign_to_group.html'\n\n    def get_success_url(self, group_pk):\n        return reverse_lazy('group_details', kwargs={'pk': group_pk})\n\n    def get(self, request, pk):\n        group = get_object_or_404(Groups, pk=pk)\n        director = get_object_or_404(Director, user=request.user)\n\n        # Logika wyszukiwania (opcjonalnie, je\u015bli dodasz pole 'q' do URL)\n        search_query = request.GET.get('q', '')\n\n        # Dzieci, kt\u00f3re mo\u017cna przypisa\u0107: nale\u017c\u0105 do dyrektora, s\u0105 aktywne i NIE maj\u0105 obecnie ustawionej grupy LUB s\u0105 w innej grupie.\n        # Najprostszy filtr to: nie maj\u0105 przypisanej grupy LUB maj\u0105 inn\u0105 grup\u0119\n        available_kids_qs = Kid.objects.filter(\n            principal=director,\n            is_active=True,\n            # Dzieci, kt\u00f3re albo maj\u0105 grup\u0119 null, albo maj\u0105 grup\u0119 inn\u0105 ni\u017c obecna\n        ).filter(\n            Q(group__isnull=True) | ~Q(group__pk=pk)\n        )\n\n        # Zastosowanie wyszukiwania\n        if search_query:\n            available_kids_qs = available_kids_qs.filter(\n                Q(first_name__icontains=search_query) | Q(last_name__icontains=search_query)\n            )\n\n        return render(request, self.template_name, {\n            'group': group,\n            'available_kids': available_kids_qs.order_by('last_name'),\n            'search_query': search_query,\n        })\n\n    def post(self, request, pk):\n        group = get_object_or_404(Groups, pk=pk)\n        director = get_object_or_404(Director, user=request.user)\n\n        # POBIERAMY LIST\u0118 ID DZIECI Z CHECKBOX\u00d3W (np. ['1', '5', '9'])\n        kid_ids = request.POST.getlist('kid_ids')\n\n        if not kid_ids:\n            messages.warning(request, \"Nie wybrano \u017cadnego dziecka do przypisania.\")\n            return redirect(self.get_success_url(pk))\n\n        # Filtrujemy wybrane dzieci, upewniaj\u0105c si\u0119, \u017ce nale\u017c\u0105 do tego dyrektora\n        kids_to_assign = Kid.objects.filter(\n            pk__in=kid_ids,\n            principal=director\n        )\n\n        # Aktualizujemy pole 'group' dla wszystkich wybranych dzieci\n        count = kids_to_assign.update(group=group)\n\n        if count &gt; 0:\n            messages.success(request, f\"Pomy\u015blnie przypisano {count} dzieci do grupy {group.name}.\")\n        else:\n            messages.error(request, \"Nie uda\u0142o si\u0119 przypisa\u0107 dzieci lub zosta\u0142y one ju\u017c usuni\u0119te/przypisane.\")\n\n        return redirect(self.get_success_url(pk))\n</code></pre>"},{"location":"modules/groups.html#groups.views.AssignTeachersView","title":"<code>groups.views.AssignTeachersView</code>","text":"<p>               Bases: <code>LoginRequiredMixin</code>, <code>PermissionRequiredMixin</code>, <code>View</code></p> Source code in <code>groups/views.py</code> <pre><code>class AssignTeachersView(LoginRequiredMixin, PermissionRequiredMixin, View):\n    permission_required = 'director.is_director'\n    template_name = 'teacher_assign_to_group.html'  # Utw\u00f3rz ten szablon\n\n    def get_success_url(self, group_pk):\n        return reverse_lazy('group_details', kwargs={'pk': group_pk})\n\n    def get(self, request, pk):\n        group = get_object_or_404(Groups, pk=pk)\n\n        # Tworzymy formularz, przekazuj\u0105c ID grupy i dyrektora do __init__\n        form = AssignTeachersForm(\n            group_pk=pk,\n            current_user=request.user\n        )\n\n        return render(request, self.template_name, {\n            'form': form,\n            'group': group,\n        })\n\n    def post(self, request, pk):\n        group = get_object_or_404(Groups, pk=pk)\n\n        # Przekazujemy dane POST i te same argumenty do formularza\n        form = AssignTeachersForm(\n            request.POST,\n            group_pk=pk,\n            current_user=request.user\n        )\n\n        if form.is_valid():\n            # Zbieramy QuerySet wybranych nauczycieli\n            teachers_qs = form.cleaned_data['teachers_to_assign']\n\n            # 1. Aktualizujemy pole 'group' dla wszystkich wybranych nauczycieli\n            # U\u017cywamy .update() dla efektywno\u015bci\n            count = teachers_qs.update(group=group)\n\n            messages.success(request, f\"Pomy\u015blnie przypisano {count} nauczycieli do grupy {group.name}.\")\n            return redirect(self.get_success_url(pk))\n\n        # Je\u015bli formularz jest niepoprawny, renderujemy go ponownie z b\u0142\u0119dami\n        return render(request, self.template_name, {\n            'form': form,\n            'group': group,\n        })\n</code></pre>"},{"location":"modules/groups.html#kluczowe-procesy","title":"Kluczowe Procesy:","text":"<ol> <li>Tworzenie Grupy: Wymaga wcze\u015bniejszego wgrania ikon w module <code>director</code>.</li> <li>Usuwanie Grupy: System nie usuwa danych trwale. Grupa staje si\u0119 nieaktywna, a przypisane do niej dzieci zostaj\u0105 \"uwolnione\" (ich pole grupy zostaje w&gt;</li> </ol> <pre><code>erDiagram\n    %% CORE TABLE: Group Definition\n    DIRECTOR_DIRECTOR ||--o{ GROUPS_GROUPS : \"OneToMany, W\u0142a\u015bciciel Grupy\"\n    DIRECTOR_GROUPPHOTOS }|--|| GROUPS_GROUPS : \"ForeignKey, Ikona Grupy\"\n\n    GROUPS_GROUPS {\n        bigint id PK\n        bigint principal_id FK\n        bigint photo_id FK\n        varchar name\n        integer capacity\n        integer yearbook\n        boolean is_active\n    }\n\n    %% RELATIONS TO OTHER APPS\n    GROUPS_GROUPS ||--o{ CHILDREN_KID : \"OneToMany, Zawiera Dzieci\"\n    GROUPS_GROUPS }o--|| TEACHER_EMPLOYEE : \"ForeignKey, Nauczyciel Grupy\"\n    BLOG_POST }o--|| GROUPS_GROUPS : \"ManyToMany, Adresat Og\u0142oszenia\"\n\n    %% JUNCTION TABLE for Blog\n    BLOG_POST_GROUP {\n        bigint id PK\n        bigint post_id FK\n        bigint groups_id FK\n    }\n\n    BLOG_POST ||--o{ BLOG_POST_GROUP : \"Relacja do Post\u00f3w\"\n    GROUPS_GROUPS ||--o{ BLOG_POST_GROUP : \"Relacja do Grup (Adresowanie)\"</code></pre>"},{"location":"modules/meals.html","title":"\ud83e\udd57 Meals (\u017bywienie)","text":""},{"location":"modules/meals.html#modu-zywienia-meals","title":"Modu\u0142 \u017bywienia (Meals)","text":"<p>Modu\u0142 <code>meals</code> odpowiada za definiowanie plan\u00f3w \u017cywieniowych dost\u0119pnych w plac\u00f3wce, ich opis\u00f3w oraz koszt\u00f3w jednostkowych.</p>"},{"location":"modules/meals.html#logika-biznesowa","title":"Logika Biznesowa","text":"<ul> <li>Kategoryzacja Diet: Dyrektor mo\u017ce tworzy\u0107 r\u00f3\u017cne plany \u017cywieniowe (np. dieta standardowa, wegetaria\u0144ska, bezglutenowa), przypisuj\u0105c im opisy i stawki d&gt;</li> <li>Wymuszona Sp\u00f3jno\u015b\u0107: System nie pozwoli na utworzenie posi\u0142ku bez przypisanej ikony, co gwarantuje, \u017ce interfejs rodzica i nauczyciela b\u0119dzie zawsze cz&gt;</li> <li>Zarz\u0105dzanie Kosztami: Pole <code>per_day</code> jest kluczowe dla modu\u0142u finansowego, umo\u017cliwiaj\u0105c automatyczne wyliczanie nale\u017cno\u015bci za wy\u017cywienie na podstawie &gt;</li> </ul>"},{"location":"modules/meals.html#workflow-przykad-uzycia","title":"\ud83d\udd04 Workflow / Przyk\u0142ad u\u017cycia:","text":""},{"location":"modules/meals.html#dla-dyrektora","title":"\ud83c\udf93 Dla Dyrektora","text":"<ul> <li>Zadanie: Dyrektor chce wprowadzi\u0107 nowy plan \u017cywieniowy \"Dieta Wege\".</li> <li>Krok 1: Wgrywa ikon\u0119 warzyw w module medi\u00f3w (<code>Director</code>).</li> <li>Krok 2: Wchodzi w <code>MealAddView</code>, podaje nazw\u0119, cen\u0119 (np. 15.50 PLN) i wybiera ikon\u0119.</li> <li>Krok 3: Po dodaniu, przechodzi do modu\u0142u <code>Children</code> i przypisuje wybrany posi\u0142ek do odpowiednich podopiecznych.</li> </ul>"},{"location":"modules/meals.html#dla-nauczyciela","title":"\ud83d\udc69\ud83c\udfeb Dla Nauczyciela","text":"<ul> <li>Zadanie: Sprawdzenie, jakie posi\u0142ki powinny otrzyma\u0107 dzieci w grupie.</li> <li>Dzia\u0142anie: Nauczyciel wchodzi w profil grupy. Dzi\u0119ki relacji <code>kid_set</code>, system wy\u015bwietla przy ka\u017cdym dziecku przypisany mu typ posi\u0142ku, co u\u0142atwia wyd&gt;</li> </ul>"},{"location":"modules/meals.html#dla-rodzica","title":"\ud83d\udc6a Dla Rodzica","text":"<ul> <li>Zadanie: Sprawdzenie opisu diety dziecka.</li> <li>Dzia\u0142anie: Rodzic w profilu dziecka widzi nazw\u0119 przypisanego posi\u0142ku oraz jego szczeg\u00f3\u0142owy opis (np. list\u0119 alergen\u00f3w wprowadzon\u0105 w polu <code>description</code> &gt;</li> </ul>"},{"location":"modules/meals.html#dokumentacja-techniczna","title":"Dokumentacja Techniczna","text":"<pre><code>erDiagram\n    %% CORE TABLE: Meal/Diet Definition\n    DIRECTOR_DIRECTOR ||--o{ MEALS_MEALS : \"OneToMany, Definiuje plan\"\n    DIRECTOR_MEALPHOTOS }|--|| MEALS_MEALS : \"ForeignKey, Ikona Posi\u0142ku\"\n\n    MEALS_MEALS ||--o{ CHILDREN_KID : \"ForeignKey, Przypisany plan \u017cywieniowy\"\n\n    MEALS_MEALS {\n        bigint id PK\n        bigint principal_id FK\n        bigint photo_id FK\n        varchar name\n        text description\n        numeric per_day \"Koszt dzienny do rozlicze\u0144\"\n        boolean is_active\n    }</code></pre>"},{"location":"modules/meals.html#meals.models.Meals","title":"<code>meals.models.Meals</code>","text":"<p>               Bases: <code>Model</code></p> Source code in <code>meals/models.py</code> <pre><code>class Meals(models.Model):\n    name = models.CharField(max_length=128)\n    description = models.TextField(null=True)\n    principal = models.ForeignKey(Director, on_delete=models.CASCADE, null=True)\n    photo = models.ForeignKey(MealPhotos, on_delete=models.CASCADE, null=True)\n    per_day = models.DecimalField(max_digits=6, decimal_places=2, null=True)\n    is_active = models.BooleanField(default=True)\n\n    def __str__(self):\n        \"\"\"\n        String representation\n        \"\"\"\n        return f'{self.name}'\n</code></pre>"},{"location":"modules/meals.html#meals.models.Meals.__str__","title":"<code>__str__()</code>","text":"<p>String representation</p> Source code in <code>meals/models.py</code> <pre><code>def __str__(self):\n    \"\"\"\n    String representation\n    \"\"\"\n    return f'{self.name}'\n</code></pre>"},{"location":"modules/meals.html#meals.views.MealAddView","title":"<code>meals.views.MealAddView</code>","text":"<p>               Bases: <code>PermissionRequiredMixin</code>, <code>View</code></p> Source code in <code>meals/views.py</code> <pre><code>class MealAddView(PermissionRequiredMixin, View):\n    permission_required = \"director.is_director\"\n\n    def get(self, request):\n        director = Director.objects.get(user=request.user.id)\n        photos = director.mealphotos_set.filter(is_active=True)\n        if photos:\n            return render(request, 'meal-add.html', {'photos': photos})\n        messages.info(request, 'Najpierwsz musisz dodac jakas iconke')\n        return redirect('photo_add')\n\n    def post(self, request):\n        director = request.user.director\n        photo_id = request.POST.get('photo')\n        per_day = request.POST.get('per_day')\n        name = request.POST.get('name')\n        description = request.POST.get('description')\n        image = get_object_or_404(MealPhotos, id=int(photo_id))\n        if image and name and description and per_day:\n            new_meal = Meals.objects.create(name=name, description=description, principal=director,\n                                            per_day=float(per_day), photo=image)\n\n        elif image and name and per_day:\n            new_meal = Meals.objects.create(name=name, principal=director, per_day=float(per_day), photo=image)\n\n        else:\n            messages.error(request, 'Wszystkie pola musza byc wypelnione')\n            return redirect('add_meal')\n\n        messages.success(request, f'poprawnie dodano posilek o nazwie {new_meal.name}')\n        return redirect('list_meals')\n</code></pre>"},{"location":"modules/meals.html#meals.views.MealsListView","title":"<code>meals.views.MealsListView</code>","text":"<p>               Bases: <code>PermissionRequiredMixin</code>, <code>View</code></p> Source code in <code>meals/views.py</code> <pre><code>class MealsListView(PermissionRequiredMixin, View):\n    permission_required = \"director.is_director\"\n\n    def get(self, request):\n        meals = Meals.objects.filter(principal__user=request.user).filter(is_active=True).order_by('-id')\n        paginator = Paginator(meals, 8)\n        page = request.GET.get('page')\n        page_obj = paginator.get_page(page)\n        return render(request, 'meals-list.html', {'page_obj': page_obj})\n</code></pre>"},{"location":"modules/meals.html#meals.views.MealsUpdateView","title":"<code>meals.views.MealsUpdateView</code>","text":"<p>               Bases: <code>PermissionRequiredMixin</code>, <code>View</code></p> Source code in <code>meals/views.py</code> <pre><code>class MealsUpdateView(PermissionRequiredMixin, View):\n    permission_required = \"director.is_director\"\n\n    def get(self, request, pk):\n        director = Director.objects.get(user=request.user.id)\n        meal = Meals.objects.filter(is_active=True).filter(id=int(pk)).filter(principal=director).first()\n        if meal:\n            current_photo = meal.photo\n            photos = director.mealphotos_set.filter(is_active=True)\n            return render(request, 'meal-update.html',\n                          {\n                              'meal': meal,\n                              'current_photo': current_photo,\n                              'photos': photos\n                          })\n        raise PermissionDenied\n\n    def post(self, request, pk):\n        name = request.POST.get(\"name\")\n        description = request.POST.get(\"description\")\n        per_day = request.POST.get(\"per_day\")\n        photo = request.POST.get(\"photo\")\n        photo = get_object_or_404(MealPhotos, id=int(photo))\n        meal = Meals.objects.filter(is_active=True).filter(id=int(pk)).first()\n        if meal:\n            if name and description and per_day and photo:\n                meal.name = name\n                meal.description = description\n                meal.per_day = per_day\n                meal.photo = photo\n                meal.save()\n\n                return redirect('list_meals')\n            messages.error(request, \"Wypelnij wszystkie pola\")\n            return redirect('meals_update', pk=pk)\n        raise PermissionDenied\n</code></pre>"},{"location":"modules/meals.html#meals.views.MealDeleteView","title":"<code>meals.views.MealDeleteView</code>","text":"<p>               Bases: <code>PermissionRequiredMixin</code>, <code>View</code></p> Source code in <code>meals/views.py</code> <pre><code>class MealDeleteView(PermissionRequiredMixin, View):\n    permission_required = \"director.is_director\"\n\n    def get(self, request, pk):\n        raise PermissionDenied\n\n    def post(self, request, pk):\n        meal = get_object_or_404(Meals, id=int(pk))\n        director = Director.objects.get(user=request.user.id)\n        if meal.principal == director:\n            for kid in meal.kid_set.filter(is_active=True):\n                kid.kid_meals = None\n                kid.save()\n            meal.delete()\n            messages.success(request,\n                             f'Popprawnie usunieto posilek {meal}')\n            return redirect('list_meals')\n        raise PermissionDenied\n</code></pre>"},{"location":"modules/parent.html","title":"\ud83d\udc6a Parent (Rodzice)","text":""},{"location":"modules/parent.html#modu-rodzica-parent","title":"\ud83d\udc6a Modu\u0142 Rodzica (Parent)","text":"<p>Modu\u0142 ten odpowiada za zarz\u0105dzanie profilami opiekun\u00f3w oraz budowanie bezpiecznych relacji pomi\u0119dzy rodzicami a ich dzie\u0107mi w ramach plac\u00f3wki.</p>"},{"location":"modules/parent.html#logika-biznesowa-automatyzacja-i-relacje","title":"Logika Biznesowa (Automatyzacja i Relacje)","text":"<ul> <li>Model Onboardingu: Rodzice nie przechodz\u0105 przez standardowy proces rejestracji. S\u0105 oni zapraszani przez Dyrektora, co gwarantuje, \u017ce do systemu trafia&gt;</li> <li>Elastyczno\u015b\u0107 Powi\u0105za\u0144: Model <code>ParentA</code> pozwala na przypisanie wielu dzieci do jednego opiekuna oraz wielu rodzic\u00f3w do jednego dziecka. Umo\u017cliwia to ob&gt;</li> <li>Izolacja \"Silent\": System rygorystycznie ogranicza uprawnienia rodzica wy\u0142\u0105cznie do danych jego dzieci. Rodzic nie ma wgl\u0105du w list\u0119 innych dzieci, ro&gt;</li> </ul>"},{"location":"modules/parent.html#workflow-przykad-uzycia","title":"\ud83d\udd04 Workflow / Przyk\u0142ad u\u017cycia:","text":""},{"location":"modules/parent.html#scenariusz-zaproszenie-opiekuna-do-systemu","title":"\ud83c\udf93 Scenariusz: Zaproszenie opiekuna do systemu","text":"<ul> <li>Akcja: Dyrektor u\u017cywa widoku <code>InviteAndAssignParentView</code>, podaj\u0105c adres e-mail rodzica.</li> <li>Automatyzacja: System w ramach jednej transakcji atomowej tworzy konto u\u017cytkownika, nadaje mu rol\u0119 <code>is_parent</code>, generuje bezpieczne has\u0142o i wysy\u0142a je &gt;</li> <li>Zaleta: Minimalizuje to czas pracy administracyjnej dyrekcji i zapewnia natychmiastowy dost\u0119p rodzica do panelu podopiecznego.</li> </ul>"},{"location":"modules/parent.html#scenariusz-samodzielna-aktualizacja-danych-kontaktowych","title":"\ud83d\udc6a Scenariusz: Samodzielna aktualizacja danych kontaktowych","text":"<ul> <li>Akcja: Rodzic po przeprowadzce zmienia numer telefonu w <code>ParentProfileView</code>.</li> <li>Dzia\u0142anie: System wykorzystuje <code>RegexValidator</code> do natychmiastowej weryfikacji formatu numeru (standard polski +48). Dzi\u0119ki temu plac\u00f3wka ma pewno\u015b\u0107, &gt;</li> </ul>"},{"location":"modules/parent.html#dokumentacja-techniczna","title":"Dokumentacja Techniczna","text":""},{"location":"modules/parent.html#parent.models.ParentA","title":"<code>parent.models.ParentA</code>","text":"<p>               Bases: <code>Model</code></p> Source code in <code>parent/models.py</code> <pre><code>class ParentA(models.Model):\n    gender_choices = ((1, 'Mezczyzna'), (2, 'Kobieta'))\n    user = models.OneToOneField(User, on_delete=models.CASCADE)\n    first_name = models.CharField(max_length=128, null=True)\n    last_name = models.CharField(max_length=128, null=True)\n    kids = models.ManyToManyField(Kid)\n    gender = models.IntegerField(choices=gender_choices, null=True)\n    phone_regex = RegexValidator(regex=r'^(?&lt;!\\w)(\\(?(\\+|00)?48\\)?)?[ -]?\\d{3}[ -]?\\d{3}[ -]?\\d{3}(?!\\w)$',\n                                 message=\"Numer telefony musi byc w formie: '+48 999 999 999' albo '(+48 999 999 999)' albo '999 999 999'.\",\n                                 code='invalid_numer_telefonu')\n    phone = models.CharField(null=True, unique=True, max_length=17, validators=[phone_regex])\n    city = models.CharField(max_length=64, null=True)\n    address = models.CharField(max_length=128, null=True)\n    zip_code = models.CharField(null=True, max_length=6, validators=[RegexValidator(\n        regex=r'^([0-9]{2}-[0-9]{3})$',\n        message=(u'Kod pocztowy musi byc w formacie 00-000'),\n        code=\"invalid_zip_code\",\n    )])\n    principal = models.ManyToManyField(Director)\n\n    def __str__(self):\n        return f'{self.user.email} Profile'\n\n    class Meta:\n        permissions = [\n            (\"is_parent\", 'parent permission')\n        ]\n</code></pre>"},{"location":"modules/parent.html#parent.views.InviteAndAssignParentView","title":"<code>parent.views.InviteAndAssignParentView</code>","text":"<p>               Bases: <code>LoginRequiredMixin</code>, <code>PermissionRequiredMixin</code>, <code>View</code></p> Source code in <code>parent/views.py</code> <pre><code>class InviteAndAssignParentView(LoginRequiredMixin, PermissionRequiredMixin, View):\n    permission_required = \"director.is_director\"\n    template_name = 'parent-invite-standalone.html' # B\u0119dziemy renderowa\u0107 ten szablon tylko w przypadku b\u0142\u0119d\u00f3w GET\n    PAGINATE_BY = 10\n\n    def get(self, request):\n        # Pobierz list\u0119 dzieci do wy\u015bwietlenia w modalnym oknie\n        user_director = get_object_or_404(Director, user=request.user)\n        search_query = request.GET.get('search', '').strip()\n        page_number = request.GET.get('page')\n        # Pobierz wszystkie aktywne dzieci dyrektora, kt\u00f3re nie maj\u0105 jeszcze rodzica (lub maj\u0105 tylko jednego)\n        # Zale\u017cnie od twojej logiki, mo\u017ce to by\u0107:\n        # kids_list = user_director.kid_set.filter(parenta__isnull=True, is_active=True)\n        # Dla uproszczenia (i mo\u017cliwo\u015bci wielokrotnego przypisania):\n        kids_qs = user_director.kid_set.filter(is_active=True).order_by('last_name', 'first_name')\n\n        if search_query:\n            # Filtrujemy tylko, je\u015bli jest zapytanie\n            kids_qs = kids_qs.filter(\n                Q(first_name__icontains=search_query) |\n                Q(last_name__icontains=search_query)\n            )\n\n        paginator = Paginator(kids_qs, self.PAGINATE_BY)\n        page_obj = paginator.get_page(page_number)\n        context = {\n            'kids_list': page_obj, # Przekazujemy obiekt paginacji\n            'search_query': search_query\n        }\n        # W widoku GET nie robimy nic, bo modal jest cz\u0119\u015bci\u0105 innego szablonu (np. list_kids/list_parent)\n        # Je\u015bli ten widok by\u0142by wywo\u0142ywany samodzielnie, u\u017cywamy:\n        return render(request, self.template_name, context)\n\n    def post(self, request):\n        if 'search_button' in request.POST:\n            # Obs\u0142uga wyszukiwania z pola tekstowego (wymagane dla paginacji)\n            search = request.POST.get('search', '').strip()\n\n            if search:\n\n                return redirect(f\"{request.path}?search={search}\")\n            else:\n                return redirect(request.path)\n        user_director = get_object_or_404(Director, user=request.user)\n        parent_email = request.POST.get('email', '').strip()\n        # Odbieramy list\u0119 ID dzieci (z checkbox\u00f3w)\n        kid_ids = request.POST.getlist('kid_id')\n\n        # --- Walidacja ---\n        if not parent_email:\n            messages.error(request, 'Pole Email Rodzica jest wymagane.')\n            return redirect('invite_standalone_parent')\n\n        if User.objects.filter(email=parent_email).exists():\n            messages.error(request, 'Ten email jest ju\u017c zaj\u0119ty.')\n            return redirect('invite_standalone_parent')\n\n\n        # --- LOGIKA TWORZENIA KONTA Z TRANSAKCJ\u0104 ---\n        try:\n            with transaction.atomic():\n\n                # 1. Utw\u00f3rz u\u017cytkownika\n                password = User.objects.make_random_password()\n                parent_user = User.objects.create_user(email=parent_email, password=password)\n\n                # 2. Utw\u00f3rz obiekt ParentA i przypisz Dyrektora\n                par_user = ParentA.objects.create(user=parent_user)\n                par_user.principal.add(user_director)\n\n                # 3. Przypisz dzieci (je\u015bli istniej\u0105)\n                if kid_ids:\n                    kids_to_assign = user_director.kid_set.filter(id__in=kid_ids)\n                    par_user.kids.add(*kids_to_assign)\n\n                # 4. Przypisz uprawnienie 'is_parent'\n                content_type = ContentType.objects.get_for_model(ParentA)\n                permission = Permission.objects.get(content_type=content_type, codename='is_parent')\n                par_user.user.user_permissions.clear()\n                par_user.user.user_permissions.add(permission)\n                par_user.save()\n\n                # 5. Wy\u015blij zaproszenie\n                subject = \"Zaproszenie na konto przedszkola dla rodzica\"\n                from_email = EMAIL_HOST_USER\n                text_content = \"Zosta\u0142e\u015b zaproszony do utworzenia konta rodzica w systemie przedszkola.\"\n                html_content = render_to_string('email_to_parent.html', {'password': password, 'email': parent_email})\n\n                msg = EmailMultiAlternatives(subject, text_content, from_email, [parent_email])\n                msg.attach_alternative(html_content, \"text/html\")\n                msg.send()\n\n            messages.success(request, f\"Pomy\u015blnie utworzono konto i wys\u0142ano zaproszenie dla {parent_email}.\")\n            return redirect('list_parent')\n\n        except Exception as e:\n            messages.error(request, f'Wyst\u0105pi\u0142 b\u0142\u0105d podczas tworzenia konta: {e}')\n            return redirect('invite_standalone_parent')\n</code></pre>"},{"location":"modules/parent.html#parent.views.ParentProfileView","title":"<code>parent.views.ParentProfileView</code>","text":"<p>               Bases: <code>LoginRequiredMixin</code>, <code>View</code></p> Source code in <code>parent/views.py</code> <pre><code>class ParentProfileView(LoginRequiredMixin, View):\n    def get(self, request, pk):\n        user = request.user\n        parent = get_object_or_404(ParentA, id=int(pk))\n        context = {\n            'parent': parent\n\n        }\n        if user.get_user_permissions() == {'parent.is_parent'}:\n            if parent.user.email == user.email:\n                return render(request, 'parent_profile.html', context)\n        elif user.get_user_permissions() == {'director.is_director'}:\n            director = get_object_or_404(Director, user=user.id)\n            if parent in director.parenta_set.all():\n                return render(request, 'parent_profile.html', context)\n        elif user.get_user_permissions() == {'teacher.is_teacher'}:\n            teacher = get_object_or_404(Employee, user=user.id)\n            if parent.kids.filter(group=teacher.group).filter(is_active=True):\n                return render(request, 'parent_profile.html', context)\n\n        raise PermissionDenied\n</code></pre>"},{"location":"modules/parent.html#parent.views.AddParentToKidView","title":"<code>parent.views.AddParentToKidView</code>","text":"<p>               Bases: <code>PermissionRequiredMixin</code>, <code>View</code></p> Source code in <code>parent/views.py</code> <pre><code>class AddParentToKidView(PermissionRequiredMixin, View):\n    permission_required = \"director.is_director\"\n    PAGINATE_BY = 10 # Ilo\u015b\u0107 dzieci na stron\u0119\n\n    def get(self, request, pk):\n        parent = get_object_or_404(ParentA, id=int(pk))\n        user_director = get_object_or_404(Director, user=request.user)\n        search_query = request.GET.get('search', '').strip()\n        page_number = request.GET.get('page')\n\n        # 1. Walidacja uprawnie\u0144 (czy dyrektor jest prze\u0142o\u017conym rodzica)\n        if parent.principal.filter(user=request.user).exists():\n\n            # 2. Pobieramy dzieci aktywne, nieprzypisane jeszcze do tego rodzica\n            kids_qs = user_director.kid_set.filter(is_active=True).exclude(parenta=parent)\n\n            # 3. Filtrowanie (je\u015bli search_query jest obecne)\n            if search_query:\n                kids_qs = kids_qs.filter(\n                    Q(first_name__icontains=search_query) |\n                    Q(last_name__icontains=search_query)\n                ).distinct()\n\n            # Sortowanie i paginacja\n            kids_qs = kids_qs.order_by('last_name', 'first_name')\n            paginator = Paginator(kids_qs, self.PAGINATE_BY)\n            kids_list = paginator.get_page(page_number)\n\n            # Wczytujemy z sesji/POST list\u0119 ju\u017c zaznaczonych dzieci (je\u015bli u\u017cytkownik prze\u0142adowa\u0142 stron\u0119)\n            # Lista ID dzieci, kt\u00f3re by\u0142y zaznaczone w ostatnim POST/GET\n            previously_selected_kids = request.session.get('selected_kids_for_parent_link', [])\n\n            context = {\n                'kids_list': kids_list,\n                'parent': parent,\n                'search_query': search_query,\n                'previously_selected_kids': previously_selected_kids,\n            }\n            return render(request, 'parent-kid-add.html', context)\n\n        raise PermissionDenied\n\n    def post(self, request, pk):\n        parent = get_object_or_404(ParentA, id=int(pk))\n        user_director = get_object_or_404(Director, user=request.user)\n\n        # 1. Sprawdzamy, czy formularz POST to wyszukiwanie, czy zapis\n        if 'search_button' in request.POST:\n            # U\u017cyjemy tej logiki, je\u015bli musisz u\u017cy\u0107 POST do wyszukiwania\n            search = request.POST.get('search', '').strip()\n\n            # Zapisz aktualny stan checkbox\u00f3w do sesji, zanim prze\u0142adujesz stron\u0119 GET\n            selected_kids = request.POST.getlist('kids', [])\n            request.session['selected_kids_for_parent_link'] = selected_kids\n\n            if search:\n                return redirect(f\"{request.path}?search={search}\")\n            else:\n                return redirect(request.path)\n\n\n        # 2. Logika zapisu link\u00f3w (g\u0142\u00f3wny submit)\n        if parent.principal.filter(user=request.user).exists():\n\n            # Lista ID dzieci wybranych przez u\u017cytkownika\n            kids_ids_to_link = request.POST.getlist('kids', [])\n            if not kids_ids_to_link:\n                messages.warning(request, f'Wybierz conajmniej jedno dziecko do podpi\u0119cia')\n                return redirect(request.path)\n                # Sprawdzenie, czy dyrektor ma prawo do tych dzieci\n            valid_kids_qs = user_director.kid_set.filter(is_active=True, id__in=kids_ids_to_link)\n\n            count = 0\n            for kid in valid_kids_qs:\n                if kid not in parent.kids.all():\n                    parent.kids.add(kid)\n                    count += 1\n\n            # Usuwamy stan sesji po pomy\u015blnym zapisie\n            if 'selected_kids_for_parent_link' in request.session:\n                del request.session['selected_kids_for_parent_link']\n\n            messages.success(request, f'Poprawnie dodano {count} dzieci do {parent.user.email}')\n            return redirect('parent_profile', pk=parent.id)\n\n        raise PermissionDenied\n</code></pre>"},{"location":"modules/parent.html#parent.views.create_parent_ajax","title":"<code>parent.views.create_parent_ajax(request)</code>","text":"Source code in <code>parent/views.py</code> <pre><code>@csrf_exempt\ndef create_parent_ajax(request):\n    if request.method != \"POST\" or not request.user.is_authenticated:\n        return JsonResponse({\"success\": False, \"error\": \"Brak dost\u0119pu\"})\n    body = json.loads(request.body)\n    email = body.get('email', '').strip()\n    try:\n        if not email or '@' not in email:\n            return JsonResponse({\"success\": False, \"error\": \"Wpisz poprawny e-mail\"})\n\n        if User.objects.filter(email=email).exists():\n            return JsonResponse({\"success\": False, \"error\": \"Ten e-mail ju\u017c jest zaj\u0119ty\"})\n\n        # Generujemy has\u0142o\n        import random, string\n        password = ''.join(random.choices(string.ascii_letters + string.digits, k=12))\n\n        # Tworzymy u\u017cytkownika i rodzica\n        user = User.objects.create_user(\n            email=email,\n            password=password\n        )\n        content_type = ContentType.objects.get_for_model(ParentA)\n        permission = Permission.objects.get(content_type=content_type, codename='is_parent')\n        principal = Director.objects.get(user=request.user.id)\n        par_user = ParentA.objects.create(user=user)\n        par_user.principal.add(principal)\n        par_user.user.user_permissions.clear()\n        par_user.user.user_permissions.add(permission)\n        user.parenta.save()\n\n        # Wysy\u0142amy e-mail z has\u0142em\n        subject = f\"Zaproszenie do KinderManage \u2013 konto rodzica dla Twojego dziecka\"\n        text_content = f\"Cze\u015b\u0107!\\n\\nTwoje konto zosta\u0142o utworzone.\\nE-mail: {email}\\nHas\u0142o: {password}\\n\\nZaloguj si\u0119 tutaj: {request.scheme}://{request.get_host()}\\n\\nPozdrawiamy,\\nZesp\u00f3\u0142 KinderManage\"\n\n        html_content = render_to_string('email_to_parent.html', {\n            'password': password,\n            'email': email,\n            'login_url': f\"{request.scheme}://{request.get_host()}\"\n        })\n\n        msg = EmailMultiAlternatives(subject, text_content, settings.EMAIL_HOST_USER, [email])\n        msg.attach_alternative(html_content, \"text/html\")\n        msg.send()\n\n        return JsonResponse({\n            \"success\": True,\n            \"email\": email\n        })\n    except Exception as e:\n        User.objects.filter(email=email).first().delete()\n        return JsonResponse({\"success\": False, \"error\": str(e)})\n</code></pre>"},{"location":"modules/parent.html#kluczowe-procesy-techniczne","title":"Kluczowe Procesy Techniczne:","text":"<ol> <li>Bezpieczna Rekrutacja: Widok <code>create_parent_ajax</code> pozwala na szybkie dodawanie profilu rodzica bez konieczno\u015bci prze\u0142adowania strony, co przyspiesza &gt;</li> <li>Synchronizacja z Plac\u00f3wk\u0105: Ka\u017cdy profil rodzica jest powi\u0105zany z modelem <code>Director</code> (<code>principal</code>), co zapewnia, \u017ce komunikacja i dane kontaktowe prze&gt;</li> <li>Prywatno\u015b\u0107 przez Design: Widoki profilu rodzica u\u017cywaj\u0105 <code>LoginRequiredMixin</code> oraz sprawdzaj\u0105 w\u0142asno\u015b\u0107 obiektu, uniemo\u017cliwiaj\u0105c innym rodzicom dost\u0119p &gt;</li> </ol> <pre><code>erDiagram\n    %% CORE TABLE: Parent Profile\n    ACCOUNTS_USER ||--|| PARENT_PARENTA : \"OneToOne, Profil Rodzica\"\n\n    PARENT_PARENTA ||--o{ CHILDREN_KID : \"ManyToMany, Opiekuje si\u0119 dzie\u0107mi\"\n    PARENT_PARENTA ||--o{ DIRECTOR_DIRECTOR : \"ManyToMany, Pod nadzorem Dyrektora\"\n\n    PARENT_PARENTA {\n        bigint id PK\n        bigint user_id FK UK\n        varchar first_name\n        varchar last_name\n        integer gender\n        varchar phone UK \"WALIDACJA REGEX +48\"\n        varchar address\n        varchar city\n        varchar zip_code \"WALIDACJA 00-000\"\n    }\n\n    %% JUNCTION TABLES (Implied ManyToMany)\n    PARENT_PARENTA_KIDS {\n        bigint id PK\n        bigint parenta_id FK\n        bigint kid_id FK\n    }\n    PARENT_PARENTA_PRINCIPAL {\n        bigint id PK\n        bigint parenta_id FK\n        bigint director_id FK\n    }\n\n    PARENT_PARENTA ||--o{ PARENT_PARENTA_KIDS : \"Relacja do Dzieci\"\n    CHILDREN_KID ||--o{ PARENT_PARENTA_KIDS : \"Relacja do Opiekun\u00f3w\"\n\n    PARENT_PARENTA ||--o{ PARENT_PARENTA_PRINCIPAL : \"Relacja do Dyrektor\u00f3w\"\n    DIRECTOR_DIRECTOR ||--o{ PARENT_PARENTA_PRINCIPAL : \"Relacja do Rodzic\u00f3w\"</code></pre>"},{"location":"modules/payments_plans.html","title":"\ud83d\udcb3 Payments (Finanse)","text":""},{"location":"modules/payments_plans.html#modu-finansowy-payments-plans","title":"\ud83d\udcb3 Modu\u0142 Finansowy (Payments Plans)","text":"<p>Modu\u0142 <code>payments_plans</code> odpowiada za definicj\u0119 struktury przychod\u00f3w plac\u00f3wki poprzez zarz\u0105dzanie planami abonamentowymi (czesnym).</p>"},{"location":"modules/payments_plans.html#logika-biznesowa","title":"Logika Biznesowa","text":"<ul> <li>Elastyczno\u015b\u0107 Cennik\u00f3w: Dyrektor mo\u017ce tworzy\u0107 wiele plan\u00f3w p\u0142atniczych (np. \"Czesne standardowe\", \"Zni\u017cka dla rodze\u0144stwa\", \"P\u00f3\u0142 etatu\"), co pozwala na &gt;</li> <li>Integracja z Profilem Dziecka: Ka\u017cde dziecko w systemie musi mie\u0107 przypisany plan p\u0142atniczy. Jest to podstawa do wystawiania miesi\u0119cznych not ksi\u0119gowy&gt;</li> <li>Automatyzacja Relacji: System dba o to, aby usuni\u0119cie planu p\u0142atniczego nie uszkodzi\u0142o profilu dziecka \u2013 w takim przypadku status finansowy podopieczn&gt;</li> </ul>"},{"location":"modules/payments_plans.html#workflow-przykad-uzycia","title":"\ud83d\udd04 Workflow / Przyk\u0142ad u\u017cycia:","text":""},{"location":"modules/payments_plans.html#dla-dyrektora","title":"\ud83c\udf93 Dla Dyrektora","text":"<ul> <li>Zadanie: Wprowadzenie nowej stawki czesnego na kolejny rok szkolny.</li> <li>Krok 1: Dyrektor wchodzi w <code>AddPaymentsPlanView</code>, podaje nazw\u0119 (np. \"Czesne 2024\") i kwot\u0119 (np. 800.00 PLN).</li> <li>Krok 2: Po zapisaniu, plan pojawia si\u0119 na li\u015bcie <code>PaymentPlansListView</code>.</li> <li>Krok 3: Dyrektor przechodzi do edycji danych dzieci (<code>Children</code>) i masowo przypisuje im now\u0105 stawk\u0119.</li> </ul>"},{"location":"modules/payments_plans.html#dla-rodzica","title":"\ud83d\udc6a Dla Rodzica","text":"<ul> <li>Zadanie: Weryfikacja koszt\u00f3w sta\u0142ych.</li> <li>Dzia\u0142anie: Rodzic w panelu podgl\u0105du dziecka widzi nazw\u0119 przypisanego planu oraz jego cen\u0119 bazow\u0105. Dzi\u0119ki temu wie, jaka jest kwota sta\u0142a przed dolicze&gt;</li> </ul>"},{"location":"modules/payments_plans.html#dokumentacja-techniczna","title":"Dokumentacja Techniczna","text":"<pre><code>erDiagram\n    %% CORE TABLE: Payment Plan Definition (Czesne)\n    DIRECTOR_DIRECTOR ||--o{ PAYMENTS_PLANS_PAYMENTPLAN : \"OneToMany, Definiuje plan\"\n\n    PAYMENTS_PLANS_PAYMENTPLAN ||--o{ CHILDREN_KID : \"ForeignKey, Przypisany plan czesnego\"\n\n    PAYMENTS_PLANS_PAYMENTPLAN {\n        bigint id PK\n        bigint principal_id FK\n        varchar name\n        numeric price \"Stawka czesnego (sta\u0142a)\"\n        boolean is_active\n    }</code></pre>"},{"location":"modules/payments_plans.html#payments_plans.models.PaymentPlan","title":"<code>payments_plans.models.PaymentPlan</code>","text":"<p>               Bases: <code>Model</code></p> Source code in <code>payments_plans/models.py</code> <pre><code>class PaymentPlan(models.Model):\n    name = models.CharField(max_length=128)\n    price = models.DecimalField(max_digits=7, decimal_places=2, default=500)\n    principal = models.ForeignKey(Director, on_delete=models.CASCADE, null=True)\n    is_active = models.BooleanField(default=True)\n\n    def __str__(self):\n        \"\"\"\n        String representation\n        \"\"\"\n        return f'{self.name}'\n</code></pre>"},{"location":"modules/payments_plans.html#payments_plans.models.PaymentPlan.__str__","title":"<code>__str__()</code>","text":"<p>String representation</p> Source code in <code>payments_plans/models.py</code> <pre><code>def __str__(self):\n    \"\"\"\n    String representation\n    \"\"\"\n    return f'{self.name}'\n</code></pre>"},{"location":"modules/payments_plans.html#payments_plans.views.AddPaymentsPlanView","title":"<code>payments_plans.views.AddPaymentsPlanView</code>","text":"<p>               Bases: <code>PermissionRequiredMixin</code>, <code>SuccessMessageMixin</code>, <code>CreateView</code></p> Source code in <code>payments_plans/views.py</code> <pre><code>class AddPaymentsPlanView(PermissionRequiredMixin, SuccessMessageMixin, CreateView):\n    permission_required = \"director.is_director\"\n    model = PaymentPlan\n    template_name = 'payment-plan-add.html'\n    form_class = PaymentPlanForm\n    success_url = reverse_lazy('list_payments_plans')\n    success_message = \"Plan platnicz dodany porpawnie\"\n\n    def get_initial(self):\n        initial = super(AddPaymentsPlanView, self).get_initial()\n        initial = initial.copy()\n        initial['principal'] = Director.objects.get(user=self.request.user.id)\n        return initial\n\n    def form_valid(self, form):\n        form.instance.save()\n        return super().form_valid(form)\n</code></pre>"},{"location":"modules/payments_plans.html#payments_plans.views.PaymentPlansListView","title":"<code>payments_plans.views.PaymentPlansListView</code>","text":"<p>               Bases: <code>PermissionRequiredMixin</code>, <code>View</code></p> Source code in <code>payments_plans/views.py</code> <pre><code>class PaymentPlansListView(PermissionRequiredMixin, View):\n    permission_required = \"director.is_director\"\n\n    def get(self, request):\n        payments_plans = PaymentPlan.objects.filter(principal__user=request.user).filter(is_active=True).order_by('-id')\n        paginator = Paginator(payments_plans, 10)\n        page = request.GET.get('page')\n        page_obj = paginator.get_page(page)\n        return render(request, 'payments-plans-list.html', {'page_obj': page_obj})\n</code></pre>"},{"location":"modules/payments_plans.html#payments_plans.views.PaymentPlanUpdateView","title":"<code>payments_plans.views.PaymentPlanUpdateView</code>","text":"<p>               Bases: <code>PermissionRequiredMixin</code>, <code>View</code></p> Source code in <code>payments_plans/views.py</code> <pre><code>class PaymentPlanUpdateView(PermissionRequiredMixin, View):\n    permission_required = \"director.is_director\"\n\n    def get(self, request, pk):\n        payment = get_object_or_404(PaymentPlan, id=int(pk))\n        director = Director.objects.get(user=request.user.id)\n        if payment:\n            if payment.principal == director:\n                form = PaymentPlanForm(instance=payment)\n                return render(request, 'payment-plan-update.html', {'form': form})\n        raise PermissionDenied\n\n    def post(self, request, pk):\n        payment = get_object_or_404(PaymentPlan, id=int(pk))\n        form = PaymentPlanForm(request.POST, instance=payment)\n        if form.is_valid():\n            form.save()\n            messages.success(request, 'Poprawnie zmieniono informacje')\n            return redirect('list_payments_plans')\n        messages.error(request, f\"{form.errors}\")\n        return redirect('payment_plan_update', pk=pk)\n</code></pre>"},{"location":"modules/payments_plans.html#payments_plans.views.PaymentPlanDeleteView","title":"<code>payments_plans.views.PaymentPlanDeleteView</code>","text":"<p>               Bases: <code>PermissionRequiredMixin</code>, <code>View</code></p> Source code in <code>payments_plans/views.py</code> <pre><code>class PaymentPlanDeleteView(PermissionRequiredMixin, View):\n    permission_required = \"director.is_director\"\n\n    def get(self, request, pk):\n        raise PermissionDenied\n\n    def post(self, request, pk):\n        payment = get_object_or_404(PaymentPlan, id=int(pk))\n        director = Director.objects.get(user=request.user.id)\n        if payment.principal == director:\n            for kid in payment.kid_set.filter(is_active=True):\n                kid.payment_plan = None\n                kid.save()\n            payment.delete()\n            messages.success(request,\n                             f'Popprawnie usunieto plan platniczy {payment}')\n            return redirect('list_payments_plans')\n        raise PermissionDenied\n</code></pre>"},{"location":"modules/teacher.html","title":"\ud83d\udc69\u200d\ud83c\udfeb Teacher (Kadry)","text":""},{"location":"modules/teacher.html#modu-nauczyciela-i-kadr-teacher","title":"\ud83d\udc69\ud83c\udfeb Modu\u0142 Nauczyciela i Kadr (Teacher)","text":"<p>Modu\u0142 ten odpowiada za kompleksowe zarz\u0105dzanie personelem plac\u00f3wki, definiowanie r\u00f3l zawodowych oraz nadz\u00f3r nad struktur\u0105 zatrudnienia i wynagrodzeniami.</p>"},{"location":"modules/teacher.html#logika-biznesowa-zarzadzanie-kadrami-i-widocznosc","title":"Logika Biznesowa (Zarz\u0105dzanie Kadrami i Widoczno\u015b\u0107)","text":"<ul> <li>Zr\u00f3\u017cnicowanie R\u00f3l: System pozwala na definiowanie r\u00f3l takich jak nauczyciel, pomoc nauczyciela czy inne stanowiska administracyjne, przypisuj\u0105c im odp&gt;</li> <li>Pe\u0142na Izolacja P\u0142acowa: Dane o wynagrodzeniach (<code>salary</code>) s\u0105 \u015bci\u015ble chronione i widoczne wy\u0142\u0105cznie dla Dyrektora plac\u00f3wki. Nauczyciele ani rodzice nie&gt;</li> <li>Inteligentna Widoczno\u015b\u0107 Profilu: Profil nauczyciela jest udost\u0119pniany rodzicom w spos\u00f3b dynamiczny \u2013 rodzic widzi dane kontaktowe wychowawcy tylko wte&gt;</li> </ul>"},{"location":"modules/teacher.html#workflow-przykad-uzycia","title":"\ud83d\udd04 Workflow / Przyk\u0142ad u\u017cycia:","text":""},{"location":"modules/teacher.html#scenariusz-zatrudnienie-nowego-czonka-personelu","title":"\ud83c\udf93 Scenariusz: Zatrudnienie nowego cz\u0142onka personelu","text":"<ul> <li>Akcja: Dyrektor rejestruje pracownika za pomoc\u0105 widoku <code>EmployeeAddView</code>, podaj\u0105c jego e-mail i rol\u0119.</li> <li>Automatyzacja: System w ramach jednej transakcji tworzy konto u\u017cytkownika, nadaje mu uprawnienia techniczne <code>is_teacher</code>, generuje losowe has\u0142o i wysy&gt;</li> <li>Zaleta: Dyrektor oszcz\u0119dza czas na r\u0119cznej konfiguracji kont, a system gwarantuje, \u017ce nowy pracownik od razu trafia pod nadz\u00f3r w\u0142a\u015bciwego administrato&gt;</li> </ul>"},{"location":"modules/teacher.html#scenariusz-aktualizacja-danych-i-zarzadzanie-grupa","title":"\ud83d\udc69\ud83c\udfeb Scenariusz: Aktualizacja danych i zarz\u0105dzanie grup\u0105","text":"<ul> <li>Akcja: Nauczyciel uzupe\u0142nia sw\u00f3j profil o numer telefonu (walidowany przez Regex) w celu u\u0142atwienia kontaktu z rodzicami.</li> <li>Dzia\u0142anie: Dyrektor mo\u017ce w dowolnym momencie zmieni\u0107 przydzia\u0142 nauczyciela do grupy za pomoc\u0105 <code>ChangeEmployeeGroupView</code>, co automatycznie aktualizuje &gt;</li> </ul>"},{"location":"modules/teacher.html#dokumentacja-techniczna","title":"Dokumentacja Techniczna","text":""},{"location":"modules/teacher.html#teacher.models.Employee","title":"<code>teacher.models.Employee</code>","text":"<p>               Bases: <code>Model</code></p> Source code in <code>teacher/models.py</code> <pre><code>class Employee(models.Model):\n    gender_choices = ((1, 'Mezczyzna'), (2, 'Kobieta'))\n    first_name = models.CharField(max_length=128, null=True)\n    last_name = models.CharField(max_length=128, null=True)\n    role = models.IntegerField(choices=roles, default=3)\n    salary = models.DecimalField(max_digits=10, decimal_places=2, null=True)\n    group = models.ForeignKey(Groups, on_delete=models.CASCADE, null=True)\n    phone_regex = RegexValidator(regex=r'^(?&lt;!\\w)(\\(?(\\+|00)?48\\)?)?[ -]?\\d{3}[ -]?\\d{3}[ -]?\\d{3}(?!\\w)$',\n                                 message=\"Numer telefony musi byc w formie: '+48 999 999 999' albo '(+48 999 999 999)' albo '999 999 999'.\",\n                                 code='invalid_numer_telefonu')\n    phone = models.CharField(null=True, unique=True, max_length=17, validators=[phone_regex])\n    city = models.CharField(max_length=64, null=True)\n    address = models.CharField(max_length=128, null=True)\n    zip_code = models.CharField(null=True, max_length=6, validators=[RegexValidator(\n        regex=r'^([0-9]{2}-[0-9]{3})$',\n        message=(u'Kod pocztowy musi byc w formacie 00-000'),\n        code=\"invalid_zip_code\",\n    )])\n    gender = models.IntegerField(choices=gender_choices, null=True)\n    user = models.OneToOneField(User, on_delete=models.CASCADE)\n    principal = models.ManyToManyField(Director)\n    is_active = models.BooleanField(default=True)\n\n    class Meta:\n        permissions = [\n            (\"is_teacher\", \"Is the teacher of some group\")\n        ]\n\n    def __str__(self):\n        return f\"{self.user.email}\"\n</code></pre>"},{"location":"modules/teacher.html#teacher.views.EmployeesListView","title":"<code>teacher.views.EmployeesListView</code>","text":"<p>               Bases: <code>PermissionRequiredMixin</code>, <code>LoginRequiredMixin</code>, <code>View</code></p> Source code in <code>teacher/views.py</code> <pre><code>class EmployeesListView(PermissionRequiredMixin, LoginRequiredMixin, View):\n    permission_required = \"director.is_director\"\n\n    def get(self, request):\n        # 1. Pobieranie danych i filtry\n        user_director = Director.objects.get(user=request.user.id)\n\n        # Pobieranie parametru wyszukiwania z GET\n        search_query = request.GET.get('search', '')\n\n        # U\u017cywamy startowego QuerySetu\n        teachers = Employee.objects.filter(principal=user_director)\n\n        # 2. Logika filtrowania (je\u015bli jest zapytanie)\n        if search_query:\n            # Wyszukujemy po emailu (z icontains)\n            teachers = teachers.filter(\n                user__email__icontains=search_query\n            )\n\n        # Sortowanie\n        teachers = teachers.order_by('-id')\n\n        # 3. Paginacja\n        paginator = Paginator(teachers, 10)\n        page_number = request.GET.get(\"page\")\n        page_obj = paginator.get_page(page_number)\n\n        # Dodajemy 'search_query' do kontekstu, aby m\u00f3c go u\u017cy\u0107 w szablonie (np. do zachowania warto\u015bci w polu wyszukiwania)\n        context = {\n            'page_obj': page_obj,\n            'search_query': search_query,\n        }\n\n        return render(request, 'employees-list.html', context)\n\n    def post(self, request):\n        # W metodzie POST tylko pobieramy warto\u015b\u0107 z formularza i przekierowujemy do GET\n        search = request.POST.get('search')\n\n        base_url = reverse('list_teachers')\n\n        if search:\n            # 2. Dodaj parametr zapytania (?search=...) do podstawowego URL\n            full_url = f'{base_url}?search={search}'\n            return redirect(full_url)\n\n        # Je\u015bli pole by\u0142o puste, nadal wracamy do czystej listy\n        return redirect('list_teachers')\n</code></pre>"},{"location":"modules/teacher.html#teacher.views.EmployeeProfileView","title":"<code>teacher.views.EmployeeProfileView</code>","text":"<p>               Bases: <code>LoginRequiredMixin</code>, <code>View</code></p> Source code in <code>teacher/views.py</code> <pre><code>class EmployeeProfileView(LoginRequiredMixin, View):\n\n    def get(self, request, pk):\n        employee = get_object_or_404(Employee, id=int(pk))\n        user = self.request.user\n        if user.get_user_permissions() == {'director.is_director'}:\n            if employee.principal.first() == user.director:\n                groups = Groups.objects.filter(principal=user.director, is_active=True )\n                return render(request, 'employee-profile.html',\n                              {'employee': employee, 'groups_list': groups})\n            messages.error(request, f\"Nie ma takiego nauczyciela\")\n            return redirect('list_teachers')\n        elif user.get_user_permissions() == {'teacher.is_teacher'}:\n            if user.employee == employee:\n                return render(request, 'employee-profile.html',\n                              {'employee': employee})\n        elif user.get_user_permissions() == {'parent.is_parent'}:\n            group = employee.group\n            kids = group.kid_set.filter(is_active=True)\n            parent = ParentA.objects.get(user=user.id)\n            allow = False\n            for kid in kids:\n                if kid in parent.kids.filter(is_active=True):\n                    allow = True\n                    break\n            if allow:\n                return render(request, 'employee-profile.html',\n                              {'employee': employee})\n        raise PermissionDenied\n</code></pre>"},{"location":"modules/teacher.html#teacher.views.EmployeeAddView","title":"<code>teacher.views.EmployeeAddView</code>","text":"<p>               Bases: <code>PermissionRequiredMixin</code>, <code>View</code></p> Source code in <code>teacher/views.py</code> <pre><code>class EmployeeAddView(PermissionRequiredMixin, View):\n    permission_required = \"director.is_director\"\n\n    def get(self, request):\n        user = Director.objects.get(user=request.user.id)\n        # Pobieramy tylko aktywne grupy przypisane do tego dyrektora\n        groups = user.groups_set.filter(is_active=True)\n        return render(request, 'employee-add.html', {'groups': groups, 'roles': roles})\n\n    def post(self, request):\n        user_director = Director.objects.get(user=request.user.id)\n\n        # Wczytywanie danych\n        role_pk = request.POST.get('role')\n        salary_str = request.POST.get('salary')\n        group_id = request.POST.get('group') # Mo\u017ce by\u0107 puste\n        teacher_email = request.POST.get('email')\n\n        # Wczesna walidacja wymaganych p\u00f3l\n        if not teacher_email or not role_pk or not salary_str:\n            messages.error(request, 'Wype\u0142nij wszystkie wymagane pola (Email, Posada, Wynagrodzenie).')\n            return redirect('add_teacher')\n\n        try:\n            role = int(role_pk)\n            salary = float(salary_str)\n\n            # Walidacja, czy email nie jest zaj\u0119ty\n            if User.objects.filter(email=teacher_email).exists():\n                messages.error(request, f'Ten email jest ju\u017c zaj\u0119ty.')\n                return redirect('add_teacher')\n\n        except ValueError:\n            messages.error(request, \"Nieprawid\u0142owy format wynagrodzenia lub roli.\")\n            return redirect('add_teacher')\n\n        # Logika przypisania grupy:\n        group = None\n        if group_id:\n            # Sprawdzamy, czy wybrana grupa faktycznie nale\u017cy do tego dyrektora\n            group = user_director.groups_set.filter(id=int(group_id)).first()\n            if not group:\n                # Je\u015bli grupa zosta\u0142a wybrana, ale nie nale\u017cy do dyrektora, to jest b\u0142\u0105d.\n                messages.error(request, \"Wybrana grupa jest nieprawid\u0142owa.\")\n                return redirect('add_teacher')\n\n        # Dodatkowa walidacja dla roli 'nauczyciel' (role=2)\n        if role == 2 and not group:\n            messages.error(request, \"Dla roli 'nauczyciel' wymagane jest przypisanie grupy.\")\n            return redirect('add_teacher')\n\n\n        # --- LOGIKA TW\u00d3RCZA I TRANSKAJNA ---\n        try:\n            with transaction.atomic():\n                # 1. Utw\u00f3rz u\u017cytkownika\n                password = User.objects.make_random_password()\n                teacher_user = User.objects.create_user(email=teacher_email, password=password)\n\n                # Wyczy\u015b\u0107 stare rekordy (je\u015bli istniej\u0105)\n                # Zostawiam ten fragment, ale jest BARDZO ryzykowne:\n                from contact_app.models import ContactModel # Dodaj import\n                ContactModel.objects.filter(director__user__email=teacher_email).delete()\n                Director.objects.filter(user__email=teacher_email).delete()\n\n                # 2. Utw\u00f3rz obiekt Pracownika\n                teacher_object = Employee.objects.create(\n                    user=teacher_user,\n                    role=role,\n                    salary=salary,\n                    group=group # Przypisujemy grup\u0119 (mo\u017ce by\u0107 None)\n                )\n\n                # 3. Przypisz Dyrektora jako principal\n                user_director.employee_set.add(teacher_object)\n\n                # 4. Przypisz uprawnienie 'is_teacher'\n                from django.contrib.contenttypes.models import ContentType\n                from django.contrib.auth.models import Permission\n\n                content_type = ContentType.objects.get_for_model(Employee)\n                permission = Permission.objects.get(content_type=content_type, codename='is_teacher')\n                teacher_object.user.user_permissions.clear()\n                teacher_object.user.user_permissions.add(permission)\n\n                teacher_user.employee.save() # To jest zb\u0119dne, obiekt zosta\u0142 zapisany wy\u017cej\n\n            subject = f\"Zaproszenie na konto przedszkola dla nauczyciela\"\n            from_email = EMAIL_HOST_USER # Zmie\u0144 na faktyczn\u0105 zmienn\u0105 z settings.py\n            text_content = \"Marchewka zaprasza do korzystania z konto jako nauczyciel\"\n\n            html_content = render_to_string('email_to_parent.html', {'password': password, 'email': teacher_email})\n            msg = EmailMultiAlternatives(subject, text_content, from_email, [teacher_email])\n            msg.attach_alternative(html_content, \"text/html\")\n            msg.send()\n\n            messages.success(request, f\"Udalo sie zaprosic nauczyciela o emailu {teacher_email}\")\n            return redirect('list_teachers')\n\n        except Exception as e:\n            messages.error(request, f'Wyst\u0105pi\u0142 nieoczekiwany b\u0142\u0105d: {e}')\n            return redirect('add_teacher')\n</code></pre>"},{"location":"modules/teacher.html#teacher.views.ChangeEmployeeGroupView","title":"<code>teacher.views.ChangeEmployeeGroupView</code>","text":"<p>               Bases: <code>LoginRequiredMixin</code>, <code>PermissionRequiredMixin</code>, <code>View</code></p> Source code in <code>teacher/views.py</code> <pre><code>class ChangeEmployeeGroupView(LoginRequiredMixin, PermissionRequiredMixin, View):\n    # Nazwa tego widoku powinna by\u0107 u\u017cyta w URL-ach, np. 'change_employee_group'\n    permission_required = 'director.is_director'\n\n    def post(self, request, pk):\n        # 1. Pobierz obiekt Pracownika (pk to ID pracownika)\n        director = Director.objects.get(user=request.user.id)\n        employee = get_object_or_404(Employee, pk=pk)\n        if employee.principal.first() != director:\n            return redirect('list_teachers')\n        # 2. Pobierz warto\u015b\u0107 'group_id' z Modala (name=\"group_id\" w radio buttonach)\n        group_id = request.POST.get('group_id')\n\n        try:\n            if group_id:\n                # Wybrano grup\u0119: Znajd\u017a obiekt grupy\n                selected_group = get_object_or_404(Groups, pk=group_id)\n                employee.group = selected_group\n                messages.success(request, f\"Pomy\u015blnie przypisano {employee.user.email} do grupy {selected_group.name}.\")\n            else:\n                # Wybrano opcj\u0119 \"Brak grupy\" (group_id jest puste)\n                employee.group = None\n                messages.success(request, f\"Pomy\u015blnie usuni\u0119to przypisanie grupy dla {employee.user.email}.\")\n\n            employee.save()\n\n        except Exception as e:\n            messages.error(request, f\"Wyst\u0105pi\u0142 b\u0142\u0105d podczas przypisywania grupy: {e}\")\n\n        # 3. PRZEKIEROWANIE DO PROFILU PRACOWNIKA\n        return redirect('teacher-profile', pk=employee.pk)\n</code></pre>"},{"location":"modules/teacher.html#kluczowe-procesy-techniczne","title":"Kluczowe Procesy Techniczne:","text":"<ol> <li>Bezpiecze\u0144stwo Danych Wra\u017cliwych: Widok <code>EmployeeProfileView</code> zawiera logik\u0119 sprawdzaj\u0105c\u0105 rol\u0119 u\u017cytkownika, ukrywaj\u0105c pole <code>salary</code> przed ka\u017cdym, kto&gt;</li> <li>Walidacja Kontaktowa: Podobnie jak w module rodzica, dane adresowe i telefoniczne pracownik\u00f3w podlegaj\u0105 rygorystycznej walidacji formatu, co zapewnia&gt;</li> <li>Relacje Wielostronne: Model <code>Employee</code> pozwala na przypisanie pracownika do wielu dyrektor\u00f3w, co wspiera prac\u0119 personelu w sieciach plac\u00f3wek zarz\u0105dza&gt;</li> </ol> <pre><code>erDiagram\n    %% CORE TABLE: Employee Profile\n    ACCOUNTS_USER ||--|| TEACHER_EMPLOYEE : \"OneToOne, Profil Pracownika\"\n    GROUPS_GROUPS }o--|| TEACHER_EMPLOYEE : \"ForeignKey, Przypisanie do Grupy\"\n\n    TEACHER_EMPLOYEE ||--o{ DIRECTOR_DIRECTOR : \"ManyToMany, Pod nadzorem Dyrektora\"\n\n    TEACHER_EMPLOYEE {\n        bigint id PK\n        bigint user_id FK UK\n        bigint group_id FK\n        varchar first_name\n        varchar last_name\n        integer role \"1:Nauczyciel, 2:Pomoc, 3:Inny\"\n        numeric salary \"PENSJA (TYLKO DLA DYREKTORA)\"\n        varchar phone UK \"Walidacja REGEX\"\n        varchar address\n        varchar city\n        varchar zip_code\n        boolean is_active\n    }\n\n    %% JUNCTION TABLE (Implied ManyToMany)\n    TEACHER_EMPLOYEE_PRINCIPAL {\n        bigint id PK\n        bigint employee_id FK\n        bigint director_id FK\n    }\n\n    TEACHER_EMPLOYEE ||--o{ TEACHER_EMPLOYEE_PRINCIPAL : \"Relacja do Prze\u0142o\u017conych\"\n    DIRECTOR_DIRECTOR ||--o{ TEACHER_EMPLOYEE_PRINCIPAL : \"Relacja do Pracownik\u00f3w\"</code></pre>"}]}