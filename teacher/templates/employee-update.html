{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}
    <body class="font-display bg-background-light dark:bg-background-dark">
    <div class="relative flex min-h-screen w-full flex-col group/design-root">
        <div class="flex flex-1">

            <main class="flex-1 p-4 md:p-8">
                <div class="max-w-4xl mx-auto flex flex-col gap-8">

                    <div class="flex flex-wrap items-center gap-2 pt-4">
                        <a class="text-zinc-500 dark:text-zinc-400 text-sm font-medium hover:text-primary dark:hover:text-primary" href="{% url 'list_teachers' %}">KADRA</a>
                        <span class="material-symbols-outlined !text-base text-zinc-400 dark:text-zinc-500">chevron_right</span>
                        <a class="text-zinc-500 dark:text-zinc-400 text-sm font-medium hover:text-primary dark:hover:text-primary" href="{% url 'teacher-profile' pk=employee.id %}">PROFIL</a>
                        <span class="material-symbols-outlined !text-base text-zinc-400 dark:text-zinc-500">chevron_right</span>
                        <span class="text-zinc-900 dark:text-white text-sm font-medium">Edycja</span>
                    </div>

                    {% if messages %}
                        {% for message in messages %}
                            <div class="p-3 rounded-lg text-white text-center font-semibold
                        {% if message.tags == 'success' %}bg-green-600{% elif message.tags == 'error' %}bg-red-600{% else %}bg-blue-600{% endif %}" role="alert">
                                {{ message }}
                            </div>
                        {% endfor %}
                    {% endif %}

                    <div class="bg-white dark:bg-zinc-900/50 rounded-xl border border-gray-200 dark:border-zinc-800">
                        <form method="post" action="#">
                            {% csrf_token %}

                            {% if request.user.get_user_permissions == 'teacher.is_teacher' or valid %}
                                <div class="flex flex-wrap items-center justify-between gap-4 px-6 pb-3 pt-5 border-b border-gray-200 dark:border-zinc-800">
                                    <h1 class="text-zinc-900 dark:text-white text-2xl font-bold tracking-tight">
                                        Zmień dane osobowe: {{ employee.first_name }} {{ employee.last_name }}
                                    </h1>
                                    <a href="{% url 'teacher-profile' pk=employee.id %}" class="text-sm font-medium text-zinc-600 dark:text-zinc-300 hover:text-primary flex items-center gap-1.5">
                                        <span class="material-symbols-outlined !text-lg">arrow_back</span>
                                        POWRÓT
                                    </a>
                                </div>

                                <div class="p-6 flex flex-col gap-6">
                                    <div class="flex items-center gap-4">
                                        <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-16">
                                            {% if employee.gender == 2 %}
                                                <img class="rounded-full w-16 h-16 object-cover" src="{% static 'employee_female.jpg' %}" alt="Avatar kobiety"/>
                                            {% elif employee.gender == 1 %}
                                                <img class="rounded-full w-16 h-16 object-cover" src="{% static 'employee_male.jpg' %}" alt="Avatar mężczyzny"/>
                                            {% else %}
                                                <img class="rounded-full w-16 h-16 object-cover" src="{% static 'gander_null.jpg' %}" alt="Avatar neutralny"/>
                                            {% endif %}
                                        </div>
                                        <p class="text-zinc-900 dark:text-white text-base font-medium flex-1 truncate">
                                            {{ employee.user.email }}
                                        </p>
                                    </div>

                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        {{ form.group.as_hidden }}
                                        {{ form.salary.as_hidden }}
                                        {{ form.principal.as_hidden }}
                                        {{ form.role.as_hidden }}
                                        {{ form.user.as_hidden }}

                                        {{ form.first_name|as_crispy_field }}
                                        {{ form.last_name|as_crispy_field }}
                                        {{ form.gender|as_crispy_field }}

                                        {{ form.city|as_crispy_field }}
                                        {{ form.address|as_crispy_field }}
                                        {{ form.zip_code|as_crispy_field }}
                                        {{ form.phone|as_crispy_field }}

                                    </div>
                                </div>

                                <div class="flex items-center justify-end gap-3 p-4 bg-gray-50 dark:bg-zinc-900 border-t border-gray-200 dark:border-zinc-800 rounded-b-xl">
                                    <a href="{% url 'teacher-profile' pk=employee.id %}" class="flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-white dark:bg-zinc-800 text-zinc-900 dark:text-white text-sm font-medium border border-gray-300 dark:border-zinc-700 hover:bg-gray-100 dark:hover:bg-zinc-700">
                                        <span class="truncate">Anuluj</span>
                                    </a>
                                    <button type="submit" class="flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-primary text-white text-sm font-medium hover:bg-primary/90">
                                        <span class="truncate">Zmień informacje</span>
                                    </button>
                                </div>

                            {% else %}
                                <div class="flex flex-wrap items-center justify-between gap-4 px-6 pb-3 pt-5 border-b border-gray-200 dark:border-zinc-800">
                                    <h1 class="text-zinc-900 dark:text-white text-2xl font-bold tracking-tight">
                                        Edycja roli i wynagrodzenia
                                    </h1>
                                    <a href="{% url 'teacher-profile' pk=employee.id %}" class="text-sm font-medium text-zinc-600 dark:text-zinc-300 hover:text-primary flex items-center gap-1.5">
                                        <span class="material-symbols-outlined !text-lg">arrow_back</span>
                                        POWRÓT
                                    </a>
                                </div>

                                <div class="p-6 flex flex-col gap-6">
                                    <p class="text-zinc-700 dark:text-zinc-300">
                                        Obecna posada: <span class="font-semibold">{{ employee.get_role_display }}</span>. Obecne wynagrodzenie: <span class="font-semibold">{{ employee.salary|default:"0" }} zł</span>.
                                    </p>

                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                                        <div>
                                            <label class="block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1.5" for="id_role">Posada:</label>
                                            <select class="w-full rounded-lg border-gray-300 dark:border-zinc-700 bg-white dark:bg-zinc-800 text-zinc-900 dark:text-white focus:ring-primary focus:border-primary" name="role" id="id_role">
                                                {% for role_pk, role_name in roles %}
                                                    <option value="{{ role_pk }}" {% if employee.role == role_pk %}selected{% endif %}>{{ role_name|title }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>

                                        <div>
                                            <label class="block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1.5" for="salary">Miesięczne wynagrodzenie (zł):</label>
                                            <input type="number" id="salary" min="0" step="0.01"
                                                   placeholder="{{ employee.salary|default:'0' }}"
                                                   class="w-full rounded-lg border-gray-300 dark:border-zinc-700 bg-white dark:bg-zinc-800 text-zinc-900 dark:text-white focus:ring-primary focus:border-primary" name="salary"
                                                   value="{{ employee.salary|default:'' }}"
                                            />
                                        </div>

                                        <div id="group-select-container">
                                            <label class="block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1.5" for="id_group">Wybierz grupę (tylko dla nauczycieli):</label>
                                            <select class="w-full rounded-lg border-gray-300 dark:border-zinc-700 bg-white dark:bg-zinc-800 text-zinc-900 dark:text-white focus:ring-primary focus:border-primary" name="group" id="id_group">
                                                <option value="">-- Brak Grupy --</option>
                                                {% for group in groups %}
                                                    <option value="{{ group.id }}" {% if employee.group == group %}selected{% endif %}>{{ group.name }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="flex items-center justify-end gap-3 p-4 bg-gray-50 dark:bg-zinc-900 border-t border-gray-200 dark:border-zinc-800 rounded-b-xl">
                                    <button type="submit" class="flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-primary text-white text-sm font-medium hover:bg-primary/90">
                                        <span class="truncate">ZATWIERDŹ ZMIANY</span>
                                    </button>
                                </div>

                            {% endif %}
                        </form>
                    </div>
                </div>
            </main>
        </div>
    </div>

    </body>
{% endblock content %}